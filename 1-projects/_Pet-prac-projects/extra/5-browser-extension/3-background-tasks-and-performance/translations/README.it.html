<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.it</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="progetto-di-estensione-del-browser-parte-3-conoscere-le-attività-in-background-e-le-prestazioni">Progetto di Estensione del Browser Parte 3: Conoscere le attività in background e le prestazioni</h1>
<h2 id="quiz-pre-lezione">Quiz Pre-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/27?loc=it">Quiz Pre-Lezione</a></p>
<h3 id="introduzione">Introduzione</h3>
<p>Nelle ultime due lezioni di questo form, si è imparato a creare un form e un’area di visualizzazione per i dati recuperati da un’API. È un modo molto standard per creare presenze web. Si è anche appreso come gestire il recupero dei dati in modo asincrono. L’estensione del browser è quasi completa.</p>
<p>Restano da gestire alcune attività in background, incluso l’aggiornamento del colore dell’icona dell’estensione, quindi questo è un ottimo momento per parlare di come il browser gestisce questo tipo di attività. Si pensi a queste attività del browser nel contesto delle prestazioni delle proprie risorse web mentre vengono create.</p>
<h2 id="nozioni-di-base-sulle-prestazioni-web">Nozioni di base sulle prestazioni web</h2>
<blockquote>
<p>“Le prestazioni del sito web riguardano due cose: la velocità di caricamento della pagina e la velocità di esecuzione del codice su di essa.” - <a href="https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/">Zack Grossbart</a></p>
</blockquote>
<p>L’argomento su come rendere i propri siti web incredibilmente veloci su tutti i tipi di dispositivi, per tutti i tipi di utenti, in tutti i tipi di situazioni, non sorprende sia vasto. Di seguito sono riportati alcuni punti da tenere a mente quando si crea un progetto web standard o un’estensione del browser.</p>
<p>La prima cosa da fare per assicurarsi che il proprio sito funzioni in modo efficiente è raccogliere dati sulle sue prestazioni. Il primo posto per farlo è negli strumenti di sviluppo del proprio browser web. In Edge, selezionare il pulsante “Impostazioni e altro ancora” (l’icona dei tre punti in alto a destra nel browser), quindi accedere a Altri strumenti &gt; Strumenti di sviluppo e aprire la scheda Prestazioni. Si può anche utilizzare la scorciatoia da tastiera <code>Ctrl</code> + <code>Maiusc</code> + <code>I</code> su Windows o <code>Opzione</code> + <code>Comando</code> + <code>I</code> su Mac per aprire gli strumenti di sviluppo.</p>
<p>La scheda Prestazioni contiene uno strumento di profilazione. Aprire un sito web (provare, ad esempio, https://www.microsoft.com) e fare clic sul pulsante “Registra”, quindi aggiornare il sito. Interrompendo la registrazione in qualsiasi momento si sarà in grado di vedere le routine generate per “Esecuzione script”, “Rendering” e “Disegno” per il sito:</p>
<figure>
<img src="../images/profiler.png" alt="Edge profiler" /><figcaption>Edge profiler</figcaption>
</figure>
<p>✅ Visitare la <a href="https://docs.microsoft.com/microsoft-edge/devtools-guide/performance">documentazione Microsoft</a> nel pannello Prestazioni in Edge</p>
<blockquote>
<p>Suggerimento: per ottenere una lettura fedele del tempo di avvio del proprio sito web, svuotare la cache del browser</p>
</blockquote>
<p>Selezionare elementi della sequenza temporale del profilo per ingrandire gli eventi che si verificano durante il caricamento della pagina.</p>
<p>Ottenere un’istantanea delle prestazioni della propria pagina selezionando una parte della sequenza temporale del profilo e guardando il riquadro di riepilogo:</p>
<figure>
<img src="../images/snapshot.png" alt="Snapshot di Edge Profiler" /><figcaption>Snapshot di Edge Profiler</figcaption>
</figure>
<p>Controllare il riquadro “Registro Eventi” per vedere se un evento ha richiesto più di 15 ms:</p>
<figure>
<img src="../images/log.png" alt="Registro Eventi (Event Log)" /><figcaption>Registro Eventi (Event Log)</figcaption>
</figure>
<p>✅ Conoscere il propro profilatore! Aprire gli strumenti di sviluppo su questo sito e verificare se ci sono colli di bottiglia. Qual è la risorsa a caricamento più lento? La più veloce?</p>
<h2 id="controlli-di-profilazione">Controlli di profilazione</h2>
<p>In generale ci sono alcune “aree problematiche” che ogni sviluppatore web dovrebbe tenere d’occhio durante la costruzione di un sito, in modo da evitare brutte sorprese quando è il momento di distribuire in produzione.</p>
<p><strong>Dimensioni delle risorse</strong>: negli ultimi anni il Web è diventato “più pesante” e quindi più lento. Parte di questo peso ha a che fare con l’uso delle immagini.</p>
<p>✅ Cercare in <a href="https://httparchive.org/reports/page-weight">Internet Archive</a> una visualizzazione storica del peso della pagina e altro ancora.</p>
<p>Una buona pratica è garantire che le proprie immagini siano ottimizzate, distribuite con le dimensioni e la risoluzione giuste per i propri utenti.</p>
<p><strong>Attraversamenti DOM</strong>: il browser deve costruire il suo Document Object Model in base al codice che si scrive, quindi è nell’interesse di una buona prestazione della pagina mantenere i propri tag minimi, usando e disegnando solo ciò di cui la pagina ha bisogno. A questo punto si potrebbe ottimizzare il CSS in eccesso associato a una pagina; gli stili che devono essere utilizzati solo su una pagina non devono essere inclusi nel foglio di stile principale, ad esempio.</p>
<p><strong>JavaScript</strong>: ogni sviluppatore JavaScript dovrebbe controllare che gli script che bloccano il rendering siano caricati prima che il resto del DOM possa essere attraversato e visualizzato nel browser. Si consideri l’idea di utilizzare <code>defer</code> con i propri script inline (come è stato fatto nel modulo Terrario).</p>
<p>✅ Provare alcuni siti su un <a href="https://www.webpagetest.org/">sito web che verifica la velocità</a> dei siti per ulteriori informazioni sui controlli comuni eseguiti per determinare le prestazioni del sito.</p>
<p>Ora che si ha un’idea di come il browser esegue il rendering delle risorse che gli vengono inviate, si darà un’occhiata alle ultime cose da fare per completare la propria estensione:</p>
<h3 id="creare-una-funzione-per-calcolare-il-colore">Creare una funzione per calcolare il colore</h3>
<p>Lavorando in <code>/src/index.js</code>, aggiungere una funzione chiamata <code>calcolateColor()</code> dopo la serie di variabili <code>const</code> impostate per ottenere l’accesso a elementi del DOM:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">function</span> <span class="at">calculateColor</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="kw">let</span> co2Scale <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">150</span><span class="op">,</span> <span class="dv">600</span><span class="op">,</span> <span class="dv">750</span><span class="op">,</span> <span class="dv">800</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">let</span> colors <span class="op">=</span> [<span class="st">&#39;#2AA364&#39;</span><span class="op">,</span> <span class="st">&#39;#F5EB4D&#39;</span><span class="op">,</span> <span class="st">&#39;#9E4229&#39;</span><span class="op">,</span> <span class="st">&#39;#381D02&#39;</span><span class="op">,</span> <span class="st">&#39;#381D02&#39;</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">let</span> closestNum <span class="op">=</span> <span class="va">co2Scale</span>.<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-6" title="6">        <span class="cf">return</span> <span class="va">Math</span>.<span class="at">abs</span>(a <span class="op">-</span> value) <span class="op">-</span> <span class="va">Math</span>.<span class="at">abs</span>(b <span class="op">-</span> value)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="op">}</span>)[<span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="va">console</span>.<span class="at">log</span>(value <span class="op">+</span> <span class="st">&#39; is closest to &#39;</span> <span class="op">+</span> closestNum)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="kw">let</span> num <span class="op">=</span> (element) <span class="kw">=&gt;</span> element <span class="op">&gt;</span> closestNum<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="kw">let</span> scaleIndex <span class="op">=</span> <span class="va">co2Scale</span>.<span class="at">findIndex</span>(num)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">let</span> closestColor <span class="op">=</span> colors[scaleIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="va">console</span>.<span class="at">log</span>(scaleIndex<span class="op">,</span> closestColor)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">sendMessage</span>(<span class="op">{</span> <span class="dt">action</span><span class="op">:</span> <span class="st">&#39;updateIcon&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="op">{</span> <span class="dt">color</span><span class="op">:</span> closestColor <span class="op">}</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="op">}</span></a></code></pre></div>
<p>Cosa sta succedendo qui? Si passa un valore (l’intensità di carbonio) dalla chiamata API completata nell’ultima lezione, quindi si calcola quanto è vicino il suo valore all’indice presentato nell’array colors. Quindi si invia il valore di colore più vicino al runtime di chrome.</p>
<p>chrome.runtime ha <a href="https://developer.chrome.com/extensions/runtime">un’API</a> che gestisce tutti i tipi di attività in background e l’estensione sta facendo leva su questo:</p>
<blockquote>
<p>“Utilizzare l’API chrome.runtime per recuperare la pagina in background, restituire dettagli sul manifest e ascoltare e rispondere agli eventi nel ciclo di vita dell’app o dell’estensione. Si può anche utilizzare questa API per convertire il percorso relativo degli URL in percorsi URL completi”.</p>
</blockquote>
<p>✅ Se si sta sviluppando questa estensione del browser per Edge, potrebbe sorprendere che si sta utilizzando un’API chrome. Le versioni più recenti del browser Edge vengono eseguite sul motore del browser Chromium, quindi si possono sfruttare questi strumenti.</p>
<blockquote>
<p>Nota, se si desidera profilare un’estensione del browser, avviare gli strumenti di sviluppo dall’interno dell’estensione stessa, poiché si tratta di un’istanza del browser separata.</p>
</blockquote>
<h3 id="impostare-un-colore-predefinito-per-licona">Impostare un colore predefinito per l’icona</h3>
<p>Ora, nella funzione <code>init()</code> , impostare l’icona come verde generico per iniziare di nuovo chiamando l’azione <code>updateIcon</code> di chrome:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">sendMessage</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">action</span><span class="op">:</span> <span class="st">&#39;updateIcon&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="dt">value</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">            <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;green&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="op">},</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="chiamare-la-funzione-eseguire-la-chiamata">Chiamare la funzione, eseguire la chiamata</h3>
<p>Successivamente chiamare la funzione appena creata aggiungendola alla promessa restituita dall’API C02Signal:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="co">//let CO2...</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="at">calculateColor</span>(CO2)<span class="op">;</span></a></code></pre></div>
<p>Infine, in <code>/dist/background.js,</code>aggiungere l’event listener per queste chiamate di azione in background:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onMessage</span>.<span class="at">addListener</span>(<span class="kw">function</span> (msg<span class="op">,</span> sender<span class="op">,</span> sendResponse) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">&#39;updateIcon&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="va">chrome</span>.<span class="va">browserAction</span>.<span class="at">setIcon</span>(<span class="op">{</span> <span class="dt">imageData</span><span class="op">:</span> <span class="at">drawIcon</span>(<span class="va">msg</span>.<span class="at">value</span>) <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">//presa in presito dall&#39;estensione energy lollipop, simpatiica funzionalità!</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">function</span> <span class="at">drawIcon</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="kw">let</span> canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="kw">let</span> context <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="va">context</span>.<span class="at">beginPath</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="va">context</span>.<span class="at">fillStyle</span> <span class="op">=</span> <span class="va">value</span>.<span class="at">color</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="va">context</span>.<span class="at">arc</span>(<span class="dv">100</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="va">context</span>.<span class="at">fill</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="cf">return</span> <span class="va">context</span>.<span class="at">getImageData</span>(<span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="op">}</span></a></code></pre></div>
<p>In questo codice, si sta aggiungendo un listener per tutti i messaggi che arrivano al gestore di attività di backend. Se questo messaggio si chiama ‘updateIcon’, viene eseguito il codice successivo per disegnare un’icona del colore corretto utilizzando l’API Canvas.</p>
<p>✅ Si Imparerà di più sull’API Canvas nelle <a href="../../../6-space-game/2-drawing-to-canvas/translations/README.it.md">lezioni di Gioco Spaziale</a>.</p>
<p>Ora, ricompilare l’estensione (<code>npm run build</code>), aggiornare e avviare l’estensione e verificare il cambio di colore. È un buon momento per fare una commissione o lavare i piatti? Ecco, adesso è noto, non ci sono più scuse!</p>
<p>Congratulazioni, è stata creata un’utile estensione per il browser e si è imparato di più su come funziona il browser e su come profilarne le prestazioni.</p>
<hr />
<h2 id="sfida">🚀 Sfida</h2>
<p>Esaminare alcuni siti web open source che esistono da molto tempo e, in base alla loro cronologia GitHub, vedere se si riesce a determinare come sono stati ottimizzate nel corso degli anni le prestazioni, se non del tutto. Qual è il punto dolente più comune?</p>
<h2 id="quiz-post-lezione">Quiz Post-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/28?loc=it">Quiz post-lezione</a></p>
<h2 id="revisione-e-auto-apprendimento">Revisione e Auto Apprendimento</h2>
<p>Considerare l’idea di iscriversi a una <a href="https://perf.email/">newsletter sulle prestazioni</a></p>
<p>Analizzare alcuni dei modi in cui i browser misurano le prestazioni web esaminando le schede delle prestazioni nei loro strumenti web. Si sono riscontrate differenze importanti?</p>
<h2 id="compito">Compito</h2>
<p><a href="assignment.it.md">Analizzare un sito per le prestazioni</a></p>
</body>
</html>
