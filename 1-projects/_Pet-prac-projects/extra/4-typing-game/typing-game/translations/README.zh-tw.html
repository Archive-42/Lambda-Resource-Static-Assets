<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.zh-tw</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="使用事件建立遊戲">使用事件建立遊戲</h1>
<h2 id="課前測驗">課前測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/21?loc=zh_tw">課前測驗</a></p>
<h2 id="事件驅動程式設計">事件驅動程式設計</h2>
<p>當我們建立專為瀏覽器設計的應用程式時，我們會提供 Graphical User Interface (GUI) 給用戶使用，在我們建立的格式上進行互動。最常見的互動方式是透過點擊或輸入在多樣的物件。開發者面臨的問題是，我們不了解用戶會何時對這些物件產生互動！</p>
<p><a href="https://zh.wikipedia.org/zh-tw/%E4%BA%8B%E4%BB%B6%E9%A9%85%E5%8B%95%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88">事件驅動程式設計</a>是一種程式設計的方式，以建立我們的 GUI。若拆解該名詞的話，我們知道主軸關鍵會是<strong>事件(Event)</strong>。根據 Merriam-Webster，<a href="https://www.merriam-webster.com/dictionary/event">事件</a>according定義為「將發生的事」。它能有效地解決我們面臨的問題。我們知道當用戶產生互動時，什麼程式必須回應其要求，只差在我們不知道用戶會何時產生互動。</p>
<p>藉由建立新的函式，我們可以標記這段將被運行的程式碼。我們回顧一下<a href="https://zh.wikipedia.org/wiki/%E8%BF%87%E7%A8%8B%E5%BC%8F%E7%BC%96%E7%A8%8B">程序式程式設計</a>，函式會依照順序一行一行的被運行。這同樣也會被實踐在事件驅動程式設計上，差別在於<strong>如何</strong>去呼叫這些函式。</p>
<p>要處理這些事件：點擊按鈕、輸入字串等等，我們需註冊<strong>事件監聽者(Event Listeners)</strong>。事件監聽者是函式之一，負責回應當事件觸發時，提供相對應的回應。事件監聽者可以根據用戶的行為，更新使用者介面，呼叫伺服器，或是任何你想要它做的事。我們利用<a href="https://developer.mozilla.org/docs/Web/API/EventTarget/addEventListener">addEventListener</a>新增事件監聽者，提供要被運行的函式。</p>
<blockquote>
<p><strong>注意</strong> 值得注意我們有許多建立事件監聽者的方式。你可以使用匿名函式(anonymous functions)，或是有名字的；你可以使用多種的快捷，好比直接設定 <code>click</code> 屬性，或使用 <code>addEventListener</code>。在我們練習過程中，主要專注在 <code>addEventLister</code> 與匿名函式上，它們可能是開發者最常見的網頁開發技巧。同時，也是彈性最高的： <code>addEventListener</code> 作用在任何事件，任何以參數方式輸入的事件名稱。</p>
</blockquote>
<h3 id="常見事件">常見事件</h3>
<p>創造應用時，這邊有<a href="https://developer.mozilla.org/docs/Web/Events">數種事件</a>提供給你監聽。基本上，使用者在網頁上做的任何行為都會觸發事件，你需要花大量時間、大量精力確保它們有相對應的使用者體驗。幸運的是，你只需要處理少部分的事件類型。這邊是一些常見的事件類型，我們會使用其中兩種來建立遊戲：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event">點擊</a>： 使用者點擊物件，通常會是按鈕或是連結。</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/contextmenu_event">右鍵選單</a>： 使用者點擊滑鼠右鍵。</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/select_event">選取</a>： 使用者標記特定文字。</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/input_event">輸入</a>： 使用者輸入文字。</li>
</ul>
<h2 id="建立遊戲">建立遊戲</h2>
<p>現在我們藉由建立遊戲，了解事件是如何在 JavaScript 上運作的。我們的遊戲會測試玩家的打字技巧，一項程式開發員被忽略的技能之一。我們應該時刻練習打字技術！大致的遊戲流程如下：</p>
<ul>
<li>玩家點擊「開始」按鈕並產生一行要被輸入的引文</li>
<li>玩家盡快地輸入這段文字到文字框中
<ul>
<li>當單字輸入完畢時，立即標記下一個單字。</li>
<li>當玩家打錯字時，將文字框轉為紅色。</li>
<li>當玩家完成引文輸入時，顯示祝賀語與花費的時間。</li>
</ul></li>
</ul>
<p>讓我們開始建立遊戲，學習事件驅動吧！</p>
<h3 id="檔案結構">檔案結構</h3>
<p>我們總共需要三個檔案：<strong>index.html</strong>、<strong>script.js</strong>與<strong>style.css</strong>。我們來設定它們，以完成後續的步驟。</p>
<ul>
<li>建立新的資料夾存放我們的遊戲，開啟 Console 或是終端機，輸入下列指令：</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Linux 或 macOS</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">mkdir</span> typing-game <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> typing-game</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Windows</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ex">md</span> typing-game <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> typing-game</a></code></pre></div>
<ul>
<li>打開文字編輯器 Visual Studio Code</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">code</span> .</a></code></pre></div>
<ul>
<li>現在，在 Visual Studio Code 中新增三個檔案到資料夾中，分別為：
<ul>
<li>index.html</li>
<li>script.js</li>
<li>style.css</li>
</ul></li>
</ul>
<h2 id="建立使用者介面">建立使用者介面</h2>
<p>藉由回顧我們的需求，我們在 HTML 頁面上新增一些元素。這就像是看一份食譜，你需要對應的食材：</p>
<ul>
<li>一個地方呈現將被輸入的引文</li>
<li>一個地方呈現任何訊息，好比祝賀文</li>
<li>一個玩家輸入的文字框</li>
<li>一個開始按鈕。</li>
</ul>
<p>每一個物件都需要 ID ，讓 JavaScript 程式能控制它們。另外，在 HTML 檔案匯入 CSS 與 JavaScript 檔，我們等一下會編輯它們。</p>
<p>在新的 <strong>index.html</strong> 檔案中，加入下列程式碼：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1"><span class="co">&lt;!-- inside index.html --&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="kw">&lt;title&gt;</span>Typing game<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;style.css&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="kw">&lt;h1&gt;</span>Typing game!<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="kw">&lt;p&gt;</span>Practice your typing skills with a quote from Sherlock Holmes. Click **start** to begin!<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;quote&quot;</span><span class="kw">&gt;&lt;/p&gt;</span> <span class="co">&lt;!-- This will display our quote --&gt;</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;message&quot;</span><span class="kw">&gt;&lt;/p&gt;</span> <span class="co">&lt;!-- This will display any status messages --&gt;</span></a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="kw">&lt;div&gt;</span></a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> aria-label=</span><span class="st">&quot;current word&quot;</span><span class="ot"> id=</span><span class="st">&quot;typed-value&quot;</span> <span class="kw">/&gt;</span> <span class="co">&lt;!-- The textbox for typing --&gt;</span></a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> id=</span><span class="st">&quot;start&quot;</span><span class="kw">&gt;</span>Start<span class="kw">&lt;/button&gt;</span> <span class="co">&lt;!-- To start the game --&gt;</span></a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="kw">&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;script.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<h3 id="執行應用程式">執行應用程式</h3>
<p>最好的逐段開發模式是定期的確認程式結果。讓我們來執行現在的應用程式。Visual Studio Code 上有一個好用的擴充套件為<a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">Live Server</a>，它會在你儲存網頁檔案時，同時架設並更新瀏覽器上的網頁。</p>
<ul>
<li>安裝<a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">Live Server</a>，點擊連結中的 <strong>Install</strong>
<ul>
<li>瀏覽器要求開啟 Visual Studio Code，Visual Studio Code 會執行後續的安裝流程</li>
<li>安裝完後，重啟 Visual Studio Code</li>
</ul></li>
<li>一旦安裝完成，在 Visual Studio Code 下按下 Ctrl-Shift-P (或 Cmd-Shift-P) 開啟指令視窗。</li>
<li>輸入 <strong>Live Server: Open with Live Server</strong>
<ul>
<li>Live Server 會架設並發布你的網頁成果</li>
</ul></li>
<li>開啟瀏覽器，前往 <strong>https://localhost:5500</strong></li>
<li>現在你能看到你所做的網頁！</li>
</ul>
<p>讓我們來為網頁增加更多功能。</p>
<h2 id="加入-css">加入 CSS</h2>
<p>建立完 HTML 檔，現在我們為了造型加入 CSS。我們需要標記玩家需要輸入的單字，若單字輸入錯誤時需要改變文字框的顏色。利用兩組 class 來完成：</p>
<p>在檔案 <strong>style.css</strong> 加入下列語法：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb4-1" title="1"><span class="co">/* 在 style.css 中 */</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="fu">.highlight</span> {</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">background-color</span>: <span class="cn">yellow</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">}</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="fu">.error</span> {</a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="kw">background-color</span>: <span class="cn">lightcoral</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">border</span>: <span class="cn">red</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9">}</a></code></pre></div>
<p>✅ 處理 CSS 時，你可以規劃任何你想要的介面布局。花點時間讓你的網頁更迷人：</p>
<ul>
<li>變更其他字型</li>
<li>改變標題顏色</li>
<li>改變物件大小</li>
</ul>
<h2 id="javascript">JavaScript</h2>
<p>建立完使用者介面後，我們要專注在 JavaScript 上，提供網頁邏輯處理的能力。我們將工作分為下列步驟：</p>
<ul>
<li><a href="#建立常數">建立常數</a></li>
<li><a href="#加入開始邏輯">事件監聽者 - 開始遊戲</a></li>
<li><a href="#加入打字邏輯">事件監聽者 - 輸入文字</a></li>
</ul>
<p>首先，我們先編輯檔案 <strong>script.js</strong>。</p>
<h3 id="建立常數">建立常數</h3>
<p>加入一些變數給程式使用。同樣地，就像食譜一樣，我們需要的食材如下：</p>
<ul>
<li>矩陣，儲存所有引文</li>
<li>空矩陣，儲存單一引文的所有單字</li>
<li>變數，儲存空矩陣的索引，標記玩家現在面對的單字</li>
<li>變數，紀錄玩家點擊開始時的時間</li>
</ul>
<p>我們也需要將使用者介面上的物件做連結：</p>
<ul>
<li>文字框 (<strong>typed-value</strong>)</li>
<li>顯示引文 (<strong>quote</strong>)</li>
<li>訊息欄 (<strong>message</strong>)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// 在檔案 script.js 中</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">// 所有的引文內容</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">const</span> quotes <span class="op">=</span> [</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="st">&#39;When you have eliminated the impossible, whatever remains, however improbable, must be the truth.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="st">&#39;There is nothing more deceptive than an obvious fact.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="st">&#39;I ought to know by this time that when a fact appears to be opposed to a long train of deductions it invariably proves to be capable of bearing some other interpretation.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="st">&#39;I never make exceptions. An exception disproves the rule.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="st">&#39;What one man can invent another can discover.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="st">&#39;Nothing clears up a case so much as stating it to another person.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="st">&#39;Education never ends, Watson. It is a series of lessons, with the greatest for the last.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-11" title="11">]<span class="op">;</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">// 儲存單字列表及目前要輸入的單字索引</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="kw">let</span> words <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="kw">let</span> wordIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">// 開始時間</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="kw">let</span> startTime <span class="op">=</span> <span class="va">Date</span>.<span class="at">now</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">// 網頁物件連結</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="kw">const</span> quoteElement <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;quote&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="kw">const</span> messageElement <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;message&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="kw">const</span> typedValueElement <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;typed-value&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>✅ 試著加入更多的引文到你的遊戲中。</p>
<blockquote>
<p><strong>筆記</strong> 我們可以接收任何物件，只要使用程式碼 <code>document.getElementById</code>。因為我們需要定期參考這些元素，所以使用常數來確認是否有單字輸入錯誤的問題。框架如<a href="https://vuejs.org/">Vue.js</a>或<a href="https://reactjs.org/">React</a>可以幫助你更好管理你的程式碼。</p>
</blockquote>
<p>花點時間觀看下列關於 <code>const</code>、<code>let</code> 與 <code>var</code> 的影片。</p>
<p><a href="https://youtube.com/watch?v=JNIXfGiDWM8" title="變數類型"><img src="https://img.youtube.com/vi/JNIXfGiDWM8/0.jpg" alt="變數類型" /></a></p>
<blockquote>
<p>點擊上方圖片以觀賞關於變數的影片。</p>
</blockquote>
<h3 id="加入開始邏輯">加入開始邏輯</h3>
<p>為了開始我們的遊戲，玩家會點擊開始按鈕。當然，我們不知道何時玩家會開始遊戲，這就是為什麼我們使用<a href="https://developer.mozilla.org/docs/Web/API/EventTarget/addEventListener">事件監聽者</a>到程式中。一個事件監聽者允許我們監看事件的觸發與對應的回應程式。在這個例子，我們希望當使用者點擊開始時，執行某些程式。</p>
<p>當玩家點擊 <strong>start</strong> 按鈕後，我們需要挑選一段引文、設定使用者介面並追蹤現在玩家的要輸入的單字與時間。下列為我們需要新增的程式碼，我們會在之後逐行解釋。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// 在 script.js 末端</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;start&#39;</span>).<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co">// 取得一行引文</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="kw">const</span> quoteIndex <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(<span class="va">Math</span>.<span class="at">random</span>() <span class="op">*</span> <span class="va">quotes</span>.<span class="at">length</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="kw">const</span> quote <span class="op">=</span> quotes[quoteIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="co">// 將引文分成許多單字，存在矩陣中。</span></a>
<a class="sourceLine" id="cb6-7" title="7">  words <span class="op">=</span> <span class="va">quote</span>.<span class="at">split</span>(<span class="st">&#39; &#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="co">// 重制單字索引來做追蹤</span></a>
<a class="sourceLine" id="cb6-9" title="9">  wordIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="co">// 更新使用者介面</span></a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="co">// 建立 span 元素的矩陣，設定 class 用。</span></a>
<a class="sourceLine" id="cb6-13" title="13">  <span class="kw">const</span> spanWords <span class="op">=</span> <span class="va">words</span>.<span class="at">map</span>(<span class="kw">function</span>(word) <span class="op">{</span> <span class="cf">return</span> <span class="vs">`&lt;span&gt;</span><span class="sc">${</span>word<span class="sc">}</span><span class="vs"> &lt;/span&gt;`</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="co">// 轉換成字串並以 innerHTML 顯示引文</span></a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="va">quoteElement</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="va">spanWords</span>.<span class="at">join</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16">  <span class="co">// 標記第一個單字</span></a>
<a class="sourceLine" id="cb6-17" title="17">  <span class="va">quoteElement</span>.<span class="at">childNodes</span>[<span class="dv">0</span>].<span class="at">className</span> <span class="op">=</span> <span class="st">&#39;highlight&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-18" title="18">  <span class="co">// 清除訊息欄之前的訊息</span></a>
<a class="sourceLine" id="cb6-19" title="19">  <span class="va">messageElement</span>.<span class="at">innerText</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21">  <span class="co">// 設定文字框</span></a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="co">// 清除文字框</span></a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="va">typedValueElement</span>.<span class="at">value</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-24" title="24">  <span class="co">// 設定 focus</span></a>
<a class="sourceLine" id="cb6-25" title="25">  <span class="va">typedValueElement</span>.<span class="at">focus</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-26" title="26">  <span class="co">// 設定事件驅動程式</span></a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="co">// 開始計時器</span></a>
<a class="sourceLine" id="cb6-29" title="29">  startTime <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>().<span class="at">getTime</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>我們來分解程式碼吧！</p>
<ul>
<li>設定單字追蹤
<ul>
<li>使用<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Math/floor">Math.floor</a>和<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Math/random">Math.random</a>讓我們能隨機從矩陣 <code>quotes</code> 中挑選一行引文</li>
<li>轉換 <code>quote</code> 成 <code>words</code> 組成的矩陣，追蹤目前玩家正在輸入的單字</li>
<li><code>wordIndex</code> 設定為 0，玩家會從第一的單字開始輸入</li>
</ul></li>
<li>設定使用者介面
<ul>
<li>建立矩陣 <code>spanWords</code>，將每一個單字包在 <code>span</code> 元素中
<ul>
<li>這讓我們能高光標記單字</li>
</ul></li>
<li><code>join</code> 矩陣來建立字串，我們可以在 <code>quoteElement</code> 上更新 <code>innerHTML</code>
<ul>
<li>這會顯示引文給玩家檢視</li>
</ul></li>
<li>設定第一個 <code>span</code> 元素的 <code>className</code> 成 <code>highlight</code>，來標記單字呈黃色</li>
<li>修改 <code>messageElement</code>的 <code>innerText</code> 成 <code>''</code>，這會清除訊息欄的內容</li>
</ul></li>
<li>設定文字框
<ul>
<li>清除目前 <code>typedValueElement</code> 的 <code>value</code></li>
<li>設定 <code>typedValueElement</code> 成 <code>focus</code></li>
</ul></li>
<li>呼叫 <code>getTime</code> 來啟始計時器</li>
</ul>
<h3 id="加入打字邏輯">加入打字邏輯</h3>
<p>當玩家開始打字時，<code>input</code> 事件會被觸發。對應的事件監聽者需要檢查玩家是否輸入正確的單字，監控目前的遊戲狀況。回到檔案 <strong>script.js</strong>，加入下方程式碼到檔案最下方。我們會在後續解釋程式碼。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// script.js 最末端</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="va">typedValueElement</span>.<span class="at">addEventListener</span>(<span class="st">&#39;input&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="co">// 取得目前的單字</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="kw">const</span> currentWord <span class="op">=</span> words[wordIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="co">// 取得目前輸入的數值</span></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">const</span> typedValue <span class="op">=</span> <span class="va">typedValueElement</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="cf">if</span> (typedValue <span class="op">===</span> currentWord <span class="op">&amp;&amp;</span> wordIndex <span class="op">===</span> <span class="va">words</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="co">// 句子最末端</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="co">// 顯示成功</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="kw">const</span> elapsedTime <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>().<span class="at">getTime</span>() <span class="op">-</span> startTime<span class="op">;</span></a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="kw">const</span> message <span class="op">=</span> <span class="vs">`CONGRATULATIONS! You finished in </span><span class="sc">${</span>elapsedTime / <span class="dv">1000</span><span class="sc">}</span><span class="vs"> seconds.`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-13" title="13">    <span class="va">messageElement</span>.<span class="at">innerText</span> <span class="op">=</span> message<span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">typedValue</span>.<span class="at">endsWith</span>(<span class="st">&#39; &#39;</span>) <span class="op">&amp;&amp;</span> <span class="va">typedValue</span>.<span class="at">trim</span>() <span class="op">===</span> currentWord) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="co">// 單字最末端</span></a>
<a class="sourceLine" id="cb7-16" title="16">    <span class="co">// 清除輸入的數值，準備給新的單字使用</span></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="va">typedValueElement</span>.<span class="at">value</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-18" title="18">    <span class="co">// 移動到下一個單字</span></a>
<a class="sourceLine" id="cb7-19" title="19">    wordIndex<span class="op">++;</span></a>
<a class="sourceLine" id="cb7-20" title="20">    <span class="co">// 重設所有引文子元素的 class 名稱</span></a>
<a class="sourceLine" id="cb7-21" title="21">    <span class="cf">for</span> (<span class="kw">const</span> wordElement <span class="kw">of</span> <span class="va">quoteElement</span>.<span class="at">childNodes</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-22" title="22">      <span class="va">wordElement</span>.<span class="at">className</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-23" title="23">    <span class="op">}</span></a>
<a class="sourceLine" id="cb7-24" title="24">    <span class="co">// 標記新單字</span></a>
<a class="sourceLine" id="cb7-25" title="25">    <span class="va">quoteElement</span>.<span class="at">childNodes</span>[wordIndex].<span class="at">className</span> <span class="op">=</span> <span class="st">&#39;highlight&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">currentWord</span>.<span class="at">startsWith</span>(typedValue)) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-27" title="27">    <span class="co">// 單字目前輸入正確</span></a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="co">// 標記下一個單字</span></a>
<a class="sourceLine" id="cb7-29" title="29">    <span class="va">typedValueElement</span>.<span class="at">className</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-30" title="30">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-31" title="31">    <span class="co">// 單字輸入錯誤</span></a>
<a class="sourceLine" id="cb7-32" title="32">    <span class="va">typedValueElement</span>.<span class="at">className</span> <span class="op">=</span> <span class="st">&#39;error&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-33" title="33">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>讓我們分解程式碼吧！我們開始取得目前的單字與玩家輸入的數值。我們建立一系列的邏輯，檢查引文是否輸入完成，單字是否輸入完成，單字是否正確、是否錯誤。</p>
<ul>
<li>引文完成，檢查 <code>typedValue</code> 與 <code>currentWord</code> 相等且 <code>wordIndex</code> 與 <code>words</code> 的 <code>length</code> 減一相等。
<ul>
<li>計算 <code>elapsedTime</code> ，利用目前時間減去 <code>startTime</code> 取得遊戲時長</li>
<li><code>elapsedTime</code> 除以 1,000 ，轉化毫秒單位為秒單位</li>
<li>顯示成功訊息</li>
</ul></li>
<li>單字完成，以 <code>typedValue</code> 間的空白為界，檢查 <code>typedValue</code> 是否與 <code>currentWord</code> 相等
<ul>
<li>設定 <code>typedElement</code> 的 <code>value</code> 成 <code>''</code> ，準備給下一個單字輸入進來</li>
<li>增加 <code>wordIndex</code> 到下一個單字</li>
<li>進迴圈，每一個 <code>quoteElement</code> 的 <code>childNodes</code> ，它們的 <code>className</code> 都被設為 <code>''</code> ，代表預設的單字呈現規則</li>
<li>設定單字的 <code>className</code> 成 <code>highlight</code> 來標記為下一個被輸入的單字</li>
</ul></li>
<li>單字目前輸入正確但未完成，從 <code>typedValue</code> 開始檢查 <code>currentWord</code>
<ul>
<li>確保清除 <code>typedValueElement</code> 的 <code>className</code>，顯示預設的呈現方式。</li>
</ul></li>
<li>若此時輸入錯誤，我們加上錯誤規則
<ul>
<li>設定 <code>typedValueElement</code> 的 <code>className</code> 成 <code>error</code></li>
</ul></li>
</ul>
<h2 id="測試你的應用程式">測試你的應用程式</h2>
<p>我們做到最後了！最後一步就是確保我們的應用程式運作正常。試試看！不要擔心程式出現錯誤，<strong>所有的開發者</strong>都會面臨錯誤。有需要時，檢查程式訊息並偵錯。</p>
<p>點擊按鈕 <strong>start</strong>，馬上開始輸入單字！你可以看看這預覽動畫。</p>
<figure>
<img src="../../4-typing-game/images/demo.gif" alt="遊戲中的動畫" /><figcaption>遊戲中的動畫</figcaption>
</figure>
<hr />
<h2 id="挑戰">🚀 挑戰</h2>
<p>加入更多功能。</p>
<ul>
<li>在完成遊戲時，關閉 <code>input</code> 事件監聽者；遊戲重新開始時，再重新開啟它。</li>
<li>當玩家完成引文時，關閉文字框</li>
<li>以對話窗格的方式顯示恭賀訊息</li>
<li>利用<a href="https://developer.mozilla.org/docs/Web/API/Window/localStorage">localStorage</a>儲存最高分的資料</li>
</ul>
<h2 id="課後測驗">課後測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/22?loc=zh_tw">課後測驗</a></p>
<h2 id="複習與自學">複習與自學</h2>
<p>在瀏覽器上閱讀<a href="https://developer.mozilla.org/en-US/docs/Web/Events">所有開發者可運用的事件</a>，想想你能在什麼樣的場合使用各個事件。</p>
<h2 id="作業">作業</h2>
<p><a href="assignment.zh-tw.md">建立一款新的鍵盤遊戲</a></p>
</body>
</html>
