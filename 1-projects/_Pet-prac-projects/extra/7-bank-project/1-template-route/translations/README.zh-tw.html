<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.zh-tw</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="建立銀行網頁應用程式-part-1html-模板與網頁路由">建立銀行網頁應用程式 Part 1：HTML 模板與網頁路由</h1>
<h2 id="課前測驗">課前測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/41?loc=zh_tw">課前測驗</a></p>
<h3 id="大綱">大綱</h3>
<p>自從 JavaScript 出現在瀏覽器後，網頁開始變得更複雜、更多互動。網頁技術已經普遍地用於建立功能齊全的應用程式，執行在瀏覽器上，我們稱之為<a href="https://zh.wikipedia.org/zh-tw/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">網頁應用程式</a>。基於網頁應用程式的高互動性，使用者不會想在互動後做所有頁面載入所需的等待。這也是為什麼 JavaScript 使用 DOM 來更新 HTML，提供使用者更流暢的網頁體驗。</p>
<p>在這堂課程中，我們會譜出銀行網頁應用程式的基礎，使用 HTML 模板建立不同的畫面，各自顯示並更新內容，而不必每次都需要載入整個 HTML 頁面。</p>
<h3 id="開始之前">開始之前</h3>
<p>你需要一個網頁伺服器來測試我們要建的專案。如果你還沒有，你可以安裝 <a href="https://nodejs.org">Node.js</a> 並在你的專案資料夾中使用指令 <code>npx lite-server</code>。這會建立一個本地端的網頁伺服器，在瀏覽器上開啟你的網頁程式。</p>
<h3 id="準備">準備</h3>
<p>在你的電腦上，建立資料夾 <code>bank</code>，並在裡面建立檔案 <code>index.html</code>。我們以這個 HTML <a href="https://en.wikipedia.org/wiki/Boilerplate_code">樣板</a>來開始：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;UTF-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">&lt;title&gt;</span>Bank App<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="co">&lt;!-- This is where you&#39;ll work --&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<hr />
<h2 id="html-模板templates">HTML 模板(templates)</h2>
<p>如果你想在同一個網頁上建立不同的畫面，其中一種方法是各自建立一個 HTML 檔給每一個你想呈現的子畫面。然而，這個方式有許多不便之處：</p>
<ul>
<li>你需要在切換頁面時，重新載入整個網頁。這會很花時間。</li>
<li>在不同子頁面上共享數據會是一大難題。</li>
</ul>
<p>另一個解決方案是只有一個 HTML 檔案，並使用 <code>&lt;template&gt;</code> 元素定義多個 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template">HTML 模板</a>。 一個模板提供可重複利用的 HTML 區塊，它不會顯示在瀏覽器上，而在需要之時由 JavaScript 以呈現出來。</p>
<h3 id="課題">課題</h3>
<p>我們會建立一個銀行網頁應用程式，其中包含兩個子畫面：登入頁面與儀表板頁面。首先，我們在網頁應用程式的 HTML body 上，建立放置區來放置模板的子頁面。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;app&quot;</span><span class="kw">&gt;</span>Loading...<span class="kw">&lt;/div&gt;</span></a></code></pre></div>
<p>我們給它 <code>id</code>，以利後續 JavaScript 對它的追蹤。</p>
<blockquote>
<p>提示：因為它裡面元素的內容會被置換，我們可以建立載入中訊息或提示，在應用程式載入時顯示出來。</p>
</blockquote>
<p>接下來，我們加入下列的 HTML 模板，給登入畫面使用。現在我們只加入一行標題與一個有連結的區塊，進行簡單的功能。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;login&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">&lt;h1&gt;</span>Bank App<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/dashboard&quot;</span><span class="kw">&gt;</span>Login<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<p>接著，加入另一個 HTML 模板給儀表板頁面。這個頁面就會包含不同的區塊：</p>
<ul>
<li>包含標題與登出連結的網頁標頭</li>
<li>現在的銀行帳戶餘額</li>
<li>一個歷史交易清單的表格</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;dashboard&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">&lt;header&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">&lt;h1&gt;</span>Bank App<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/login&quot;</span><span class="kw">&gt;</span>Logout<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="kw">&lt;/header&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7">    Balance: 100$</a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="kw">&lt;h2&gt;</span>Transactions<span class="kw">&lt;/h2&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="kw">&lt;table&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12">      <span class="kw">&lt;thead&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb4-14" title="14">          <span class="kw">&lt;th&gt;</span>Date<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-15" title="15">          <span class="kw">&lt;th&gt;</span>Object<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-16" title="16">          <span class="kw">&lt;th&gt;</span>Amount<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-17" title="17">        <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb4-18" title="18">      <span class="kw">&lt;/thead&gt;</span></a>
<a class="sourceLine" id="cb4-19" title="19">      <span class="kw">&lt;tbody&gt;&lt;/tbody&gt;</span></a>
<a class="sourceLine" id="cb4-20" title="20">    <span class="kw">&lt;/table&gt;</span></a>
<a class="sourceLine" id="cb4-21" title="21">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<blockquote>
<p>提示：在建立 HTML 模板時，如果你想知道它的呈現樣子為何，你可以註解掉 <code>&lt;template&gt;</code> 與 <code>&lt;/template&gt;</code>。使用 <code>&lt;!-- --&gt;</code> 來註解它們。</p>
</blockquote>
<p>✅ 你知道為什麼我們需要使用模板的 <code>id</code> 屬性嗎？我們可以使用別的屬性，例如 classes 嗎？</p>
<h2 id="利用-javascript-顯示模板">利用 JavaScript 顯示模板</h2>
<p>現在，如果你使用瀏覽器打開你的應用程式，你會看到畫面卡在 <code>Loading...</code> 的畫面。那是因為我們需要為它新增一些 JavaScript 的程式碼來顯示出這些 HTML 模板。</p>
<p>展現模板通常需要三個步驟：</p>
<ol type="1">
<li>在 DOM 內接收模板元素，舉例來說，使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById"><code>document.getElementById</code></a>。</li>
<li>複製模板元素，使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode"><code>cloneNode</code></a>。</li>
<li>將複製元素接到 DOM 的顯示元素上，例如使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild"><code>appendChild</code></a>。</li>
</ol>
<p>✅ 我們為什麼需要在接到 DOM 前，複製一份模板？你能想像如果我們省略了此步驟後，會發生什麼事嗎？</p>
<h3 id="課題-1">課題</h3>
<p>在資料夾中建立新檔案 <code>app.js</code>，並在你的 HTML 檔案的 <code>&lt;head&gt;</code> 區塊中中匯入這個新檔案：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;app.js&quot;</span><span class="ot"> defer</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>在 <code>app.js</code> 中，我們建立新函式 <code>updateRoute</code>：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>(templateId) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(templateId)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="kw">const</span> view <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="kw">const</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="va">app</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="va">app</span>.<span class="at">appendChild</span>(view)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>這裡做的事情就是我們上述提及過的三個步驟。我們使用 <code>templateId</code> 展現了模板，並將複製的內容接在我們的放置區中。注意我們需要使用 <code>cloneNode(true)</code> 來複製整個模板的子樹。</p>
<p>現在我們呼叫這個函式，指定特定的模板並觀察結果。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">updateRoute</span>(<span class="st">&#39;login&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>✅ 程式碼中 <code>app.innerHTML = '';</code> 的目的為何？如果刪去它會發生什麼事？</p>
<h2 id="建立網頁路由routing">建立網頁路由(Routing)</h2>
<p>當提及網頁應用程式時，我們稱呼 <em>路由(Routing)</em> 來連接<strong>網址(URLs)</strong>到特定的畫面上，呈現相關內容。一個含有多個 HTML 檔的網頁，網址又象徵著檔案路徑，這能自動地完成網址與檔案的轉換。舉例來說，專案資料夾內有這些檔案：</p>
<pre><code>mywebsite/index.html
mywebsite/login.html
mywebsite/admin/index.html</code></pre>
<p>若我們建立網路伺服器，根目錄為 <code>mywebsite</code>，則 URL 路由為：</p>
<pre><code>https://site.com            --&gt; mywebsite/index.html
https://site.com/login.html --&gt; mywebsite/login.html
https://site.com/admin/     --&gt; mywebsite/admin/index.html</code></pre>
<p>然而，在我們的網頁應用中，我們使用單一個 HTML 檔包含所有的子畫面到其中，所以預設的路由行為並不能幫助到本次專案。我們需要手動進行連接，使用 JavaScript 更新該被顯示出來的模板。</p>
<h3 id="課題-2">課題</h3>
<p>我們使用簡單的物件來達成 URL 網址與模板的<a href="https://en.wikipedia.org/wiki/Associative_array">關聯實體關係</a>。加入這個物件到 <code>app.js</code> 檔案的最上方。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">const</span> routes <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="st">&#39;/login&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;login&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="st">&#39;/dashboard&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>現在，我們對函式 <code>updateRoute</code> 做一些更動。我們不直接將 <code>templateId</code> 作為參數傳遞，而是接收現在的 URL 網址，在使用關聯表來取得相對應的模板 ID 數值。我們可以使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Location/pathname"><code>window.location.pathname</code></a> 來取得網址的部分路徑。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="kw">const</span> path <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">const</span> route <span class="op">=</span> routes[path]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="va">route</span>.<span class="at">templateId</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">const</span> view <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="kw">const</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="va">app</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="va">app</span>.<span class="at">appendChild</span>(view)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="op">}</span></a></code></pre></div>
<p>這邊我們建立了模板的路由關係。你可以藉由修改網址，來測試你的網頁是否正確的轉移。</p>
<p>✅ 如果你輸入了不存在的網址，它會發生什麼事？我們該如何解決呢？</p>
<h2 id="加入網頁訪問">加入網頁訪問</h2>
<p>下一個步驟為在不更改網址的情況下，新增網頁訪問的途徑。這會做出兩件事情：</p>
<ol type="1">
<li>更新現在的網址</li>
<li>更新要被顯示的模板到新的網址中</li>
</ol>
<p>我們已經完成了第二點，藉由使用函式 <code>updateRoute</code> 來完成，所以我們需要釐清該如何更新現在的網址。</p>
<p>我們需要使用 JavaScript，詳細來看為 <a href="https://developer.mozilla.org/en-US/docs/Web/API/History/pushState"><code>history.pushState</code></a>，更新網址位置並建立瀏覽紀錄，同時不更新整個 HTML 頁面。</p>
<blockquote>
<p>筆記：網頁超連結元素 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a"><code>&lt;a href&gt;</code></a> 可以建立不同網址的連接，但它預設上會讓瀏覽器重新載入 HTML 檔。我們需要手動新增 JavaScript 處理路由以避免此行為發生，在點擊事件中使用函式 preventDefault() 。</p>
</blockquote>
<h3 id="課題-3">課題</h3>
<p>我們來建立新的函式，讓應用程式得以做網頁的訪問：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">function</span> <span class="at">navigate</span>(path) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="va">window</span>.<span class="va">history</span>.<span class="at">pushState</span>(<span class="op">{},</span> path<span class="op">,</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">origin</span> <span class="op">+</span> path)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>這個方法根據導入的路徑位置，更新了現在的網址位置，再更新模板上去。<code>window.location.origin</code> 回傳了網址的根路徑，允許我們重新構築完整的網址。</p>
<p>現在，藉由上述的函式，我們可以解決找不到網頁路徑的問題。我們修改函式 <code>updateRoute</code>，在找不到該網頁時強制轉移到一個存在的網頁。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">const</span> path <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw">const</span> route <span class="op">=</span> routes[path]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="cf">if</span> (<span class="op">!</span>route) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="cf">return</span> <span class="at">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9">  ...</a></code></pre></div>
<p>如果找不到網頁路由時，我們會導往 <code>login</code> 的頁面。</p>
<p>現在，我們建立新的函式，在連結被點擊時取得網址位置，並避免瀏覽器進行預設上的重新載入：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">function</span> <span class="at">onLinkClick</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="at">navigate</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">href</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>現在我們完成應用程式的網頁訪問系統，在 HTML 檔的 <em>Login</em> 與 <em>Logout</em> 連結加入此函式。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/dashboard&quot;</span><span class="ot"> onclick=</span><span class="st">&quot;onLinkClick()&quot;</span><span class="kw">&gt;</span>Login<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb15-2" title="2">...</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/login&quot;</span><span class="ot"> onclick=</span><span class="st">&quot;onLinkClick()&quot;</span><span class="kw">&gt;</span>Logout<span class="kw">&lt;/a&gt;</span></a></code></pre></div>
<p>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclick"><code>onclick</code></a> 屬性會將 <code>click</code> 事件連接到 JavaScript 程式碼中，這邊會再呼叫函式 <code>navigate()</code>。</p>
<p>試著點擊這些連結，你應該能造訪網頁中不同的的畫面了。</p>
<p>✅ <code>history.pushState</code> 這個方法是 HTML5 標準的一部份，支援在<a href="https://caniuse.com/?search=pushState">所有當代的瀏覽器</a>上。如果你要為舊款的瀏覽器設計網頁應用程式的話，這邊有一個技巧來加在這個 API 上：在路徑前面加上 <a href="https://en.wikipedia.org/wiki/URI_fragment">hash (<code>#</code>)</a>，你可以完成網頁路由與不須重載網頁的功能，它的目的就是在同一個網頁中做內部連結的切換。</p>
<h2 id="處理瀏覽器的上一頁與下一頁">處理瀏覽器的「上一頁」與「下一頁」</h2>
<p>使用 <code>history.pushState</code> 會建立瀏覽器的瀏覽紀錄。你可以使用瀏覽器的<em>上一頁</em>來確認，它應該要能呈現像這樣的畫面：</p>
<figure>
<img src="../history.png" alt="瀏覽歷史的截圖" /><figcaption>瀏覽歷史的截圖</figcaption>
</figure>
<p>點擊上一頁數次，你會看到網址會改變且歷史紀錄也更新上去了，但同一個模板還是被顯示出來。</p>
<p>這是因為網頁不知道該如何依據歷史紀錄來呼叫 <code>updateRoute()</code>。如果你閱讀了 <a href="https://developer.mozilla.org/en-US/docs/Web/API/History/pushState"><code>history.pushState</code> 技術文件</a>，你會發現如果狀態改變 ── 同時代表著網址改變 ── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/popstate_event"><code>popstate</code></a> 事件就會被觸發。我們會利用此特徵來修復這個問題。</p>
<h3 id="課題-4">課題</h3>
<p>為了在瀏覽器歷史改變時更新該被顯示的模板，我們會以新函式來呼叫 <code>updateRoute()</code>。我們在 <code>app.js</code> 檔最下方加入：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">window</span>.<span class="at">onpopstate</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="at">updateRoute</span>()<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>筆記：我們在這裡使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">箭頭函式</a>，簡短地宣告 <code>popstate</code> 事件處理器。它與正規的函式的功能是一樣的。</p>
</blockquote>
<p>這是關於箭頭函式的回想影片：</p>
<p><a href="https://youtube.com/watch?v=OP6eEbOj2sc" title="箭頭函式"><img src="https://img.youtube.com/vi/OP6eEbOj2sc/0.jpg" alt="箭頭函式" /></a></p>
<blockquote>
<p>點擊上方圖片以觀看關於箭頭函式的影片。</p>
</blockquote>
<p>現在，試著點擊瀏覽器上的上一頁與下一頁，檢查這次模板是否正確地更新出來。</p>
<hr />
<h2 id="挑戰">🚀 挑戰</h2>
<p>加入新的模板與對應的關聯表，顯示出本應用程式第三頁的功能 ── 帳戶餘額。</p>
<h2 id="課後測驗">課後測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/42?loc=zh_tw">課後測驗</a></p>
<h2 id="複習與自學">複習與自學</h2>
<p>網頁路由是網頁開發中很棘手的部分，特別是將網頁切換轉變為單一頁面應用程式(Single Page Application)。閱讀關於<a href="https://docs.microsoft.com/en-us/azure/static-web-apps/routes?WT.mc_id=academic-13441-cxa">Azure Static Web App 提供服務的方式</a>以處理網頁路由。你能解釋為什麼文件上的某些決定會如此重要呢？</p>
<h2 id="作業">作業</h2>
<p><a href="assignment.zh-tw.md">增進網頁路由</a></p>
</body>
</html>
