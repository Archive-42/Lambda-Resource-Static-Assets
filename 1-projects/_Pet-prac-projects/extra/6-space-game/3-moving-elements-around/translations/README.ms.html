<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.ms</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="bina-permainan-angkasa-bahagian-3-menambah-gerakan">Bina Permainan Angkasa Bahagian 3: Menambah Gerakan</h1>
<h2 id="kuiz-pra-kuliah">Kuiz Pra Kuliah</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/33">Kuiz Pra Kuliah</a></p>
<p>Permainan tidak begitu menyeronokkan sehingga anda mempunyai makhluk asing di layar! Dalam permainan ini, kami akan menggunakan dua jenis pergerakan:</p>
<ul>
<li><strong>Pergerakan papan kekunci / Tetikus</strong>: ketika pengguna berinteraksi dengan papan kekunci atau tetikus untuk menggerakkan objek di layar.</li>
<li><strong>Pergerakan yang disebabkan oleh permainan</strong>: ketika permainan menggerakkan objek dengan selang waktu tertentu.</li>
</ul>
<p>Jadi bagaimana kita memindahkan sesuatu di skrin? Ini semua mengenai koordinat kartesian: kami menukar lokasi (x, y) objek dan kemudian melukis semula skrin.</p>
<p>Biasanya anda memerlukan langkah-langkah berikut untuk menyelesaikan <em>pergerakan</em> di skrin:</p>
<ol type="1">
<li><strong>Tetapkan lokasi baru</strong> untuk objek; ini diperlukan untuk melihat objek sebagai bergerak.</li>
<li><strong>Kosongkan skrin</strong>, skrin perlu dibersihkan di antara undian. Kita dapat membersihkannya dengan melukis sebuah segi empat tepat yang kita isi dengan warna latar belakang.</li>
<li><strong>Lukis semula objek</strong> di lokasi baru. Dengan melakukan ini kita akhirnya dapat memindahkan objek dari satu lokasi ke lokasi lain.</li>
</ol>
<p>Inilah rupa bentuknya dalam kod:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">//set the hero&#39;s location</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">hero</span>.<span class="at">x</span> <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">// clear the rectangle that hosts the hero</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="va">ctx</span>.<span class="at">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">// redraw the game background and hero</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="va">ctx</span>.<span class="at">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">ctx</span>.<span class="at">fillStyle</span> <span class="op">=</span> <span class="st">&quot;black&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="va">ctx</span>.<span class="at">drawImage</span>(heroImg<span class="op">,</span> <span class="va">hero</span>.<span class="at">x</span><span class="op">,</span> <span class="va">hero</span>.<span class="at">y</span>)<span class="op">;</span></a></code></pre></div>
<p>✅ Bolehkah anda memikirkan sebab mengapa menggambar semula pahlawan anda dengan banyak bingkai sesaat mungkin menambah kos prestasi? Baca mengenai <a href="https://www.html5rocks.com/en/tutorials/canvas/performance/">alternatif untuk corak ini</a>.</p>
<h2 id="mengendalikan-acara-papan-kekunci">Mengendalikan acara papan kekunci</h2>
<p>Anda mengendalikan acara dengan melampirkan acara tertentu ke kod. Peristiwa papan kekunci dipicu di seluruh tetingkap sedangkan peristiwa tetikus seperti <code>click</code> dapat dihubungkan dengan mengklik elemen tertentu. Kami akan menggunakan acara papan kekunci sepanjang projek ini.</p>
<p>Untuk menangani suatu peristiwa, anda perlu menggunakan kaedah `<code>addEventListener()</code> tetingkap dan memberikannya dua parameter input. Parameter pertama adalah nama acara, misalnya <code>keyup</code>. Parameter kedua adalah fungsi yang harus dipanggil sebagai akibat dari peristiwa yang berlaku.</p>
<p>Inilah contohnya:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;keyup&#39;</span><span class="op">,</span> (evt) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="co">// `evt.key` = string representation of the key</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="cf">if</span> (<span class="va">evt</span>.<span class="at">key</span> <span class="op">===</span> <span class="st">&#39;ArrowUp&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="co">// do something</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="op">}</span>)</a></code></pre></div>
<p>Untuk acara utama terdapat dua sifat pada acara yang boleh anda gunakan untuk melihat kunci apa yang ditekan:</p>
<ul>
<li><code>key</code>, ini adalah representasi rentetan dari kekunci yang ditekan, misalnya <code>ArrowUp</code></li>
<li><code>keyCode</code>, ini adalah representasi angka, misalnya <code>37</code>, sesuai dengan <code>ArrowLeft</code>.</li>
</ul>
<p>✅ Manipulasi acara utama berguna di luar pengembangan permainan. Apa kegunaan lain yang dapat anda fikirkan untuk teknik ini?</p>
<h3 id="kekunci-khas-peringatan">Kekunci khas: peringatan</h3>
<p>Terdapat beberapa <em>kunci</em> khas yang mempengaruhi tetingkap. Ini bermaksud bahawa jika anda sedang mendengar acara <code>keyup</code> dan anda menggunakan kekunci khas ini untuk menggerakkan wira anda, ia juga akan melakukan tatal mendatar. Untuk itu anda mungkin mahu <em>mematikan</em> tingkah laku penyemak imbas terbina dalam ini semasa anda membina permainan anda. Anda memerlukan kod seperti ini:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">let</span> onKeyDown <span class="op">=</span> <span class="kw">function</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">e</span>.<span class="at">keyCode</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="cf">switch</span> (<span class="va">e</span>.<span class="at">keyCode</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="cf">case</span> <span class="dv">37</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="cf">case</span> <span class="dv">39</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="cf">case</span> <span class="dv">38</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="cf">case</span> <span class="dv">40</span><span class="op">:</span> <span class="co">// Arrow keys</span></a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="cf">case</span> <span class="dv">32</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-9" title="9">      <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-10" title="10">      <span class="cf">break</span><span class="op">;</span> <span class="co">// Space</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb3-12" title="12">      <span class="cf">break</span><span class="op">;</span> <span class="co">// do not block other keys</span></a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;keydown&#39;</span><span class="op">,</span> onKeyDown)<span class="op">;</span></a></code></pre></div>
<p>Kod di atas akan memastikan bahawa anak panah dan kekunci spasi mempunyai tingkah laku <em>lalai</em> mereka. Mekanisme <em>shut-off</em> berlaku apabila kita memanggil <code>e.preventDefault()</code>.</p>
<h2 id="pergerakan-yang-disebabkan-oleh-permainan">Pergerakan yang disebabkan oleh permainan</h2>
<p>Kita dapat membuat sesuatu bergerak dengan menggunakan pemasa seperti fungsi <code>setTimeout()</code> atau <code>setInterval()</code> yang mengemas kini lokasi objek pada setiap centang, atau selang waktu. Begini rupa:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">let</span> id <span class="op">=</span> <span class="at">setInterval</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="co">//move the enemy on the y axis</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="va">enemy</span>.<span class="at">y</span> <span class="op">+=</span> <span class="dv">10</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">}</span>)</a></code></pre></div>
<h2 id="gelung-permainan">Gelung permainan</h2>
<p>Gelung permainan adalah konsep yang pada dasarnya adalah fungsi yang dipanggil pada selang waktu yang tetap. Ia dipanggil gelung permainan kerana segala sesuatu yang dapat dilihat oleh pengguna ditarik ke dalam gelung. Gelung permainan menggunakan semua objek permainan yang menjadi bagian dari permainan, menggambar semuanya kecuali untuk beberapa alasan tidak seharusnya menjadi bagian dari permainan lagi. Contohnya jika objek adalah musuh yang terkena laser dan meletup, ia bukan lagi bahagian dari gelung permainan semasa (anda akan mengetahui lebih lanjut mengenai perkara ini dalam pelajaran berikutnya).</p>
<p>Inilah rupa gelung permainan, yang dinyatakan dalam kod:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">let</span> gameLoopId <span class="op">=</span> <span class="at">setInterval</span>(() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">function</span> <span class="at">gameLoop</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">ctx</span>.<span class="at">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">ctx</span>.<span class="at">fillStyle</span> <span class="op">=</span> <span class="st">&quot;black&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="va">ctx</span>.<span class="at">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="at">drawHero</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="at">drawEnemies</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="at">drawStaticObjects</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="op">},</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre></div>
<p>Gelung di atas dipanggil setiap <code>200</code> milisaat untuk menggambar semula kanvas. Anda mempunyai kemampuan untuk memilih selang terbaik yang sesuai untuk permainan anda.</p>
<h2 id="meneruskan-permainan-angkasa">Meneruskan Permainan Angkasa</h2>
<p>Anda akan mengambil kod yang ada dan memanjangkannya. Mulakan dengan kod yang anda lengkapkan semasa bahagian I atau gunakan kod di [Bahagian II- starter] (karya anda).</p>
<ul>
<li><strong>Memindahkan pahlawan</strong>: anda akan menambah kod untuk memastikan anda dapat memindahkan pahlawan menggunakan kekunci anak panah.</li>
<li><strong>Pindahkan musuh</strong>: anda juga perlu menambahkan kod untuk memastikan musuh bergerak dari atas ke bawah pada kadar tertentu.</li>
</ul>
<h2 id="langkah-yang-disyorkan">Langkah yang disyorkan</h2>
<p>Cari fail yang telah dibuat untuk anda dalam sub folder <code>your-work</code>. Ia harus mengandungi yang berikut:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">-</span><span class="kw">|</span> <span class="ex">assets</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="ex">-</span><span class="kw">|</span> <span class="ex">enemyShip.png</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="ex">-</span><span class="kw">|</span> <span class="ex">player.png</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="ex">-</span><span class="kw">|</span> <span class="ex">index.html</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="ex">-</span><span class="kw">|</span> <span class="ex">app.js</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="ex">-</span><span class="kw">|</span> <span class="ex">package.json</span></a></code></pre></div>
<p>Anda memulakan projek anda folder <code>your_work</code> dengan mengetik:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="bu">cd</span> your-work</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ex">npm</span> start</a></code></pre></div>
<p>Perkara di atas akan memulakan Pelayan HTTP pada alamat <code>http: // localhost: 5000</code>. Buka penyemak imbas dan masukkan alamat itu, sekarang ia harus menjadikan pahlawan dan semua musuh; tidak ada yang bergerak - namun!</p>
<h3 id="tambah-kod">Tambah kod</h3>
<ol type="1">
<li><p><strong>Tambahkan objek khusus</strong> untuk <code>hero</code> dan <code>musuh</code> dan <code>objek permainan</code>, mereka harus mempunyai sifat <code>x</code> dan <code>y</code>. ( Ingat bahagian pada <a href="../../translations/README.ms.md">Warisan atau komposisi</a> ).</p>
<p><em>HINT</em> <code>objek permainan</code> harus menjadi objek dengan <code>x</code> dan <code>y</code> dan kemampuan untuk menarik dirinya ke kanvas.</p>
<blockquote>
<p>tip: mulakan dengan menambahkan kelas GameObject baru dengan konstruktornya digambarkan seperti di bawah, dan kemudian lukiskannya ke kanvas:</p>
</blockquote>
<pre><code>```javascript</code></pre>
<p>class GameObject { constructor(x, y) { this.x = x; this.y = y; this.dead = false; this.type = ""; this.width = 0; this.height = 0; this.img = undefined; }</p>
<p>draw(ctx) { ctx.drawImage(this.img, this.x, this.y, this.width, this.height); } } ```</p>
<p>Sekarang, panjangkan GameObject ini untuk membuat Wira dan Musuh.</p>
<pre><code> ```javascript</code></pre>
<p>class Hero extends GameObject { constructor(x, y) { …it needs an x, y, type, and speed } } ```</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">class</span> Enemy <span class="kw">extends</span> GameObject <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="at">constructor</span>(x<span class="op">,</span> y) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="kw">super</span>(x<span class="op">,</span> y)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4">    (<span class="kw">this</span>.<span class="at">width</span> <span class="op">=</span> <span class="dv">98</span>)<span class="op">,</span> (<span class="kw">this</span>.<span class="at">height</span> <span class="op">=</span> <span class="dv">50</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="kw">this</span>.<span class="at">type</span> <span class="op">=</span> <span class="st">&quot;Enemy&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="kw">let</span> id <span class="op">=</span> <span class="at">setInterval</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-7" title="7">      <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">y</span> <span class="op">&lt;</span> <span class="va">canvas</span>.<span class="at">height</span> <span class="op">-</span> <span class="kw">this</span>.<span class="at">height</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">        <span class="kw">this</span>.<span class="at">y</span> <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-9" title="9">      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-10" title="10">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Stopped at&#39;</span><span class="op">,</span> <span class="kw">this</span>.<span class="at">y</span>)</a>
<a class="sourceLine" id="cb10-11" title="11">        <span class="at">clearInterval</span>(id)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-12" title="12">      <span class="op">}</span></a>
<a class="sourceLine" id="cb10-13" title="13">    <span class="op">},</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>Tambahkan pengendali acara utama</strong> untuk mengendalikan navigasi utama (pusing pahlawan ke atas / bawah kiri / kanan)</p>
<p><em>INGAT</em> ini adalah sistem kartesian, kiri atas adalah <code>0,0</code>. Juga ingat untuk menambah kod untuk menghentikan <em>tingkah laku lalai</em></p>
<blockquote>
<p>tip: buat fungsi onKeyDown anda dan pasangkannya ke tetingkap:</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">let</span> onKeyDown <span class="op">=</span> <span class="kw">function</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="va">console</span>.<span class="at">log</span>(<span class="va">e</span>.<span class="at">keyCode</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3">      ...<span class="at">add</span> the code <span class="im">from</span> the lesson above to stop <span class="im">default</span> behavior</a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="op">}</span></a>
<a class="sourceLine" id="cb11-5" title="5">}<span class="op">;</span></a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&quot;keydown&quot;</span><span class="op">,</span> onKeyDown)<span class="op">;</span></a></code></pre></div>
<p>Periksa konsol penyemak imbas anda pada ketika ini, dan perhatikan penekanan kekunci dicatat.</p></li>
<li><p><strong>Terapkan</strong> the <a href="../../translations/README.ms.md">Pub sub pattern</a>, ini akan memastikan kod anda tetap bersih semasa anda mengikuti bahagian yang tinggal.</p>
<p>Untuk melakukan bahagian terakhir ini, anda boleh:</p>
<ol type="1">
<li><p><strong>Tambahkan pendengar acara</strong> di tetingkap:</p>
<pre><code>```javascript</code></pre>
<p>window.addEventListener(“keyup”, (evt) =&gt; { if (evt.key === “ArrowUp”) { eventEmitter.emit(Messages.KEY_EVENT_UP); } else if (evt.key === “ArrowDown”) { eventEmitter.emit(Messages.KEY_EVENT_DOWN); } else if (evt.key === “ArrowLeft”) { eventEmitter.emit(Messages.KEY_EVENT_LEFT); } else if (evt.key === “ArrowRight”) { eventEmitter.emit(Messages.KEY_EVENT_RIGHT); } }); ```</p>
<ol type="1">
<li><strong>Buat kelas EventEmitter</strong> untuk menerbitkan dan melanggan mesej:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">class</span> EventEmitter <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-3" title="3">    <span class="kw">this</span>.<span class="at">listeners</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="at">on</span>(message<span class="op">,</span> listener) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span>.<span class="at">listeners</span>[message]) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-8" title="8">      <span class="kw">this</span>.<span class="at">listeners</span>[message] <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-10" title="10">    <span class="kw">this</span>.<span class="at">listeners</span>[message].<span class="at">push</span>(listener)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="at">emit</span>(message<span class="op">,</span> payload <span class="op">=</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-14" title="14">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">listeners</span>[message]) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-15" title="15">      <span class="kw">this</span>.<span class="at">listeners</span>[message].<span class="at">forEach</span>((l) <span class="kw">=&gt;</span> <span class="at">l</span>(message<span class="op">,</span> payload))<span class="op">;</span></a>
<a class="sourceLine" id="cb13-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="op">}</span></a></code></pre></div>
<ol type="1">
<li><strong>Tambah pemalar</strong> dan sediakan EventEmitter:</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> Messages <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="dt">KEY_EVENT_UP</span><span class="op">:</span> <span class="st">&quot;KEY_EVENT_UP&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="dt">KEY_EVENT_DOWN</span><span class="op">:</span> <span class="st">&quot;KEY_EVENT_DOWN&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="dt">KEY_EVENT_LEFT</span><span class="op">:</span> <span class="st">&quot;KEY_EVENT_LEFT&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="dt">KEY_EVENT_RIGHT</span><span class="op">:</span> <span class="st">&quot;KEY_EVENT_RIGHT&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="kw">let</span> heroImg<span class="op">,</span> </a>
<a class="sourceLine" id="cb14-9" title="9">    enemyImg<span class="op">,</span> </a>
<a class="sourceLine" id="cb14-10" title="10">    laserImg<span class="op">,</span></a>
<a class="sourceLine" id="cb14-11" title="11">    canvas<span class="op">,</span> ctx<span class="op">,</span> </a>
<a class="sourceLine" id="cb14-12" title="12">    gameObjects <span class="op">=</span> []<span class="op">,</span> </a>
<a class="sourceLine" id="cb14-13" title="13">    hero<span class="op">,</span> </a>
<a class="sourceLine" id="cb14-14" title="14">    eventEmitter <span class="op">=</span> <span class="kw">new</span> <span class="at">EventEmitter</span>()<span class="op">;</span></a></code></pre></div>
<ol type="1">
<li><strong>Memulakan permainan</strong></li>
</ol></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">function</span> <span class="at">initGame</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  gameObjects <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="at">createEnemies</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="at">createHero</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="va">eventEmitter</span>.<span class="at">on</span>(<span class="va">Messages</span>.<span class="at">KEY_EVENT_UP</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="va">hero</span>.<span class="at">y</span> <span class="op">-=</span><span class="dv">5</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb15-9" title="9"></a>
<a class="sourceLine" id="cb15-10" title="10">  <span class="va">eventEmitter</span>.<span class="at">on</span>(<span class="va">Messages</span>.<span class="at">KEY_EVENT_DOWN</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-11" title="11">    <span class="va">hero</span>.<span class="at">y</span> <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-12" title="12">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14">  <span class="va">eventEmitter</span>.<span class="at">on</span>(<span class="va">Messages</span>.<span class="at">KEY_EVENT_LEFT</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-15" title="15">    <span class="va">hero</span>.<span class="at">x</span> <span class="op">-=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-17" title="17"></a>
<a class="sourceLine" id="cb15-18" title="18">  <span class="va">eventEmitter</span>.<span class="at">on</span>(<span class="va">Messages</span>.<span class="at">KEY_EVENT_RIGHT</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-19" title="19">    <span class="va">hero</span>.<span class="at">x</span> <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-20" title="20">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>Siapkan gelung permainan</strong></p>
<p>Memfaktorkan semula fungsi window.onload untuk memulakan permainan dan mengatur gelung permainan pada selang waktu yang baik. Anda juga akan menambah sinar laser:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;canvas&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3">  ctx <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&quot;2d&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-4" title="4">  heroImg <span class="op">=</span> <span class="cf">await</span> <span class="at">loadTexture</span>(<span class="st">&quot;assets/player.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-5" title="5">  enemyImg <span class="op">=</span> <span class="cf">await</span> <span class="at">loadTexture</span>(<span class="st">&quot;assets/enemyShip.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-6" title="6">  laserImg <span class="op">=</span> <span class="cf">await</span> <span class="at">loadTexture</span>(<span class="st">&quot;assets/laserRed.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8">  <span class="at">initGame</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-9" title="9">  <span class="kw">let</span> gameLoopId <span class="op">=</span> <span class="at">setInterval</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-10" title="10">    <span class="va">ctx</span>.<span class="at">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-11" title="11">    <span class="va">ctx</span>.<span class="at">fillStyle</span> <span class="op">=</span> <span class="st">&quot;black&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-12" title="12">    <span class="va">ctx</span>.<span class="at">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-13" title="13">    <span class="at">drawGameObjects</span>(ctx)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-14" title="14">  <span class="op">},</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb16-15" title="15"></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="op">};</span></a></code></pre></div></li>
<li><p><strong>Tambahkan kod</strong> untuk memindahkan musuh pada selang waktu tertentu</p>
<p>Refactor fungsi <code>createEnemies()</code> untuk membuat musuh dan mendorong mereka ke kelas gameObjects yang baru:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">function</span> <span class="at">createEnemies</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="kw">const</span> MONSTER_TOTAL <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="kw">const</span> MONSTER_WIDTH <span class="op">=</span> MONSTER_TOTAL <span class="op">*</span> <span class="dv">98</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="kw">const</span> START_X <span class="op">=</span> (<span class="va">canvas</span>.<span class="at">width</span> <span class="op">-</span> MONSTER_WIDTH) / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="kw">const</span> STOP_X <span class="op">=</span> START_X <span class="op">+</span> MONSTER_WIDTH<span class="op">;</span></a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7">  <span class="cf">for</span> (<span class="kw">let</span> x <span class="op">=</span> START_X<span class="op">;</span> x <span class="op">&lt;</span> STOP_X<span class="op">;</span> x <span class="op">+=</span> <span class="dv">98</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-8" title="8">    <span class="cf">for</span> (<span class="kw">let</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> y <span class="op">&lt;</span> <span class="dv">50</span> <span class="op">*</span> <span class="dv">5</span><span class="op">;</span> y <span class="op">+=</span> <span class="dv">50</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-9" title="9">      <span class="kw">const</span> enemy <span class="op">=</span> <span class="kw">new</span> <span class="at">Enemy</span>(x<span class="op">,</span> y)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-10" title="10">      <span class="va">enemy</span>.<span class="at">img</span> <span class="op">=</span> enemyImg<span class="op">;</span></a>
<a class="sourceLine" id="cb17-11" title="11">      <span class="va">gameObjects</span>.<span class="at">push</span>(enemy)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-12" title="12">    <span class="op">}</span></a>
<a class="sourceLine" id="cb17-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="op">}</span></a></code></pre></div>
<p>dan tambahkan fungsi <code>createHero()</code> untuk melakukan proses yang serupa untuk wira.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">function</span> <span class="at">createHero</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">  hero <span class="op">=</span> <span class="kw">new</span> <span class="at">Hero</span>(</a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="va">canvas</span>.<span class="at">width</span> / <span class="dv">2</span> <span class="op">-</span> <span class="dv">45</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="va">canvas</span>.<span class="at">height</span> <span class="op">-</span> <span class="va">canvas</span>.<span class="at">height</span> / <span class="dv">4</span></a>
<a class="sourceLine" id="cb18-5" title="5">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb18-6" title="6">  <span class="va">hero</span>.<span class="at">img</span> <span class="op">=</span> heroImg<span class="op">;</span></a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="va">gameObjects</span>.<span class="at">push</span>(hero)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="op">}</span></a></code></pre></div>
<p>dan akhirnya, tambahkan fungsi <code>drawGameObjects()</code> untuk memulakan lukisan:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">function</span> <span class="at">drawGameObjects</span>(ctx) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="va">gameObjects</span>.<span class="at">forEach</span>(go <span class="kw">=&gt;</span> <span class="va">go</span>.<span class="at">draw</span>(ctx))<span class="op">;</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>Musuh anda harus mula maju di kapal angkasa wira anda!</p></li>
</ol>
<hr />
<h2 id="cabaran">🚀 Cabaran</h2>
<p>Seperti yang anda lihat, kod anda boleh berubah menjadi ‘spaghetti code’ apabila anda mula menambahkan fungsi dan pemboleh ubah dan kelas. Bagaimana anda dapat mengatur kod anda dengan lebih baik agar lebih mudah dibaca? Lakarkan sistem untuk mengatur kod anda, walaupun masih terdapat dalam satu fail.</p>
<h2 id="kuiz-pasca-kuliah">Kuiz Pasca Kuliah</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/34">Kuiz Pasca Kuliah</a></p>
<h2 id="mengkaji-belajar-sendiri">Mengkaji &amp; Belajar Sendiri</h2>
<p>Semasa kami menulis permainan kami tanpa menggunakan kerangka kerja, ada banyak kerangka kanvas berdasarkan JavaScript untuk pengembangan permainan. Luangkan sedikit masa untuk melakukan <a href="https://github.com/collections/javascript-game-engines">membaca mengenai perkara ini</a>.</p>
<h2 id="tugasan">Tugasan</h2>
<p><a href="assignment.ms.md">Komen kod anda</a></p>
</body>
</html>
