<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2019-08-28" />
  <title>Quick Start Guide</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Quick Start Guide</h1>
<p class="date">2019-08-28</p>
</header>
<p>Trusted Web Activities can be a bit tricky to set up, especially if all you want to do is display your website. This guide will take you through creating a basic project that uses Trusted Web Activities, covering all the gotchas.</p>
<p>By the end of this guide, you will:</p>
<ul>
<li>Have used <a href="https://github.com/GoogleChromeLabs/bubblewrap">Bubblewrap</a> to build an application that uses a Trusted Web Activity and passes verification.</li>
<li>Understand when your signing keys are used.</li>
<li>Be able to determine the signature your Android Application is being built with.</li>
<li>Know how to create a basic <a href="/digital-asset-links/v1/getting-started">Digital Asset Links</a> file.</li>
</ul>
<p>To follow this guide you’ll need:</p>
<ul>
<li><a href="https://nodejs.org/en/">Node.js</a> 10 or above installed on the development computer.</li>
<li>An Android phone or emulator connected and set up for development (<a href="https://developer.android.com/studio/debug/dev-options.html#enable">Enable USB debugging</a> if you’re using a physical phone).</li>
<li>A browser that supports Trusted Web Activity on your development phone. Chrome 72 or later will work. Support in other browsers is on its way.</li>
<li>A website you’d like to view in the Trusted Web Activity.</li>
</ul>
<p>A Trusted Web Activity lets your Android App launch a full screen Browser Tab without any browser UI. This capability is restricted to websites that you own, and you prove this by setting up Digital Asset Links. Digital Asset Links consist essentially of a file on your website that points to your app and some metadata in your app that points to your website. We’ll talk <a href="#a-note-on-signing-keys">more about them later</a>.</p>
<p>When you launch a Trusted Web Activity, the browser will check that the Digital Asset Links check out, this is called <strong>verification</strong>. If verification fails, the browser will fall back to displaying your website as a <a href="/docs/android/custom-tabs">Custom Tab</a>.</p>
<h2 id="install-and-configure-bubblewrap-install-and-configure-bubblewrap">Install and configure Bubblewrap {: #install-and-configure-bubblewrap }</h2>
<p><a href="https://github.com/GoogleChromeLabs/bubblewrap">Bubblewrap</a> is a set of libraries and a command line tool (CLI) for Node.js that helps developers generate, build and run Progressive Web Apps inside Android applications, using Trusted Web Activity.</p>
<p>The CLI can be installed with the following command:</p>
<pre class="shell"><code>npm i -g @bubblewrap/cli</code></pre>
<h3 id="setting-up-the-environment">Setting up the Environment</h3>
<p>When running Bubblewrap for the first time, it will offer to automatically download and install the required external dependencies. We recommend allowing the tool do do this, as it guarantees that the dependencies are configured correctly. Check the <a href="https://github.com/GoogleChromeLabs/bubblewrap/blob/master/packages/cli/README.md">Bubblewrap documentation</a> to use an existing Java Development Kit (JDK) or Android command line tools installation.</p>
<h2 id="initialize-and-build-project-initialize-and-build">Initialize and build project {: initialize-and-build}</h2>
<p>Initializing an Android project that wraps a PWA is done by running the init command:</p>
<pre class="shell"><code>bubblewrap init --manifest=https://my-twa.com/manifest.json</code></pre>
<p>Bubblewrap will read the <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest">Web Manifest</a>, ask developers to confirm values to be used in the Android project, and generate the project using those values. Once the project has been generated, generate an APK by running:</p>
<pre class="shell"><code>bubblewrap build</code></pre>
<h2 id="run-build-and-run">Run {: #build-and-run }</h2>
<p>The build step will output a file called <code>app-release-signed.apk</code>. This file can be installed on a development device for testing or uploaded to the Play Store for release.</p>
<p>Bubblewrap provides a command to install and test the application on a local device. With the development device connected to the computer run:</p>
<pre class="shell"><code>bubblewrap install</code></pre>
<p>Alternatively, the <a href="https://developer.android.com/studio/command-line/adb#move">adb</a> tool can be used.</p>
<pre class="shell"><code>adb install app-release-signed.apk</code></pre>
<p>Note: the <code>adb</code> command-line tool is located inside the Android command-line tools in <code>android_sdk/platform-tools/</code>.</p>
<p>The application should now be available on the device launcher. When opening the application you’ll notice that your website is launched as a Custom Tab, not a Trusted Web Activity, this is because we haven’t set up our Digital Asset Links validation yet, but first…</p>
<h3 id="graphical-user-interface-gui-alternatives-for-bubblewrap">Graphical User Interface (GUI) alternatives for Bubblewrap</h3>
<p><a href="https://www.pwabuilder.com/">PWA Builder</a> provides a GUI interface that uses the Bubblewrap library to power the generation of Trusted Web Activity projects. Find more instructions on how to use PWA Builder to create an Android App that opens your PWA in <a href="https://www.davrous.com/2020/02/07/publishing-your-pwa-in-the-play-store-in-a-couple-of-minutes-using-pwa-builder/">this blogpost</a>.</p>
<h3 id="a-note-on-signing-keys-a-note-on-signing-keys">A note on signing keys {: #a-note-on-signing-keys }</h3>
<p>Digital Asset Links take into account the key that an APK has been signed with and a common cause for verification failing is to use the wrong signature. (Remember, failing verification means you’ll launch your website as a Custom Tab with browser UI at the top of the page.) When Bubblewrap builds the application, an APK will be created with a key setup during the <code>init</code> step.</p>
<h2 id="setting-up-your-asset-link-file-creating-your-asset-link-file">Setting up your asset link file {: #creating-your-asset-link-file }</h2>
<p>{% YouTube id=‘3bAQPnxLd4c’ %}</p>
<p>Besides the APK file, Bubblewrap output an <code>assetlinks.json</code> file that matches the key used to sign the APK.</p>
<p>Upload the <code>assetlinks.json</code> file generated by Bubblewrap to your website at <code>.well-known/assetlinks.json</code> (relative to the root).</p>
<h3 id="play-store-signing-play-store-signing">Play Store Signing {: #play-store-signing }</h3>
<p>If you opt in to <a href="https://developer.android.com/studio/publish/app-signing#app-signing-google-play">App signing by Google Play</a>, Google manages your app’s signing key.</p>
<p>When opted in, the key used to sign the APK that is downloaded from the Play Store will be different from the key that Bubblewrap used when building the APK. This means that the <code>assetlinks.json</code> file will need to be updated with the new signature.</p>
<p>There are two ways you can get the correct Digital Asset Link file for a Google managed app signing key:</p>
<ul>
<li>With the <a href="https://play.google.com/store/apps/details?id=dev.conn.assetlinkstool">Asset Link Tool</a>:
<ol type="1">
<li>Install the <a href="https://play.google.com/store/apps/details?id=dev.conn.assetlinkstool">Asset Link Tool</a> from the Play Store.</li>
<li>Download your app from the Google Play Store and open launch.</li>
<li>When the app launches, you’ll be given a list of all applications installed on your device by <code>applicationId</code>. Filter the list by the <code>applicationId</code> you chose earlier and click on that entry.</li>
<li>You’ll see a page listing your app’s signature and with a generated Digital Asset Link. Click on the Copy or Share buttons at the bottom to export it however you like (e.g., save to Google Keep, email it to yourself).</li>
</ol></li>
<li>Manually:
<ol type="1">
<li>Open the <a href="https://play.google.com/apps/publish/">Google Play Console</a>.</li>
<li>Select your app.</li>
<li>Choose <strong>Release management</strong> and then <strong>App signing</strong> from the panel on the left.</li>
<li>Copy the <strong>SHA-256 certificate fingerprint</strong> from under the <strong>App signing certificate</strong> section.</li>
<li>Use this value in your Digital Asset Link file.</li>
</ol></li>
</ul>
<p>It is possible to have both keys in the <code>assetlinks.json</code>. See <a href="#adding-more-keys">Adding More Keys</a> below for more information on how to do it.</p>
<h3 id="ensuring-your-asset-link-file-is-accessible-ensuring-your-asset-link-file-is-accessible">Ensuring your asset link file is accessible {: #ensuring-your-asset-link-file-is-accessible }</h3>
<p>Now that you’ve uploaded it, make sure you can access your asset link file in a browser. Check that <code>https://example.com/.well-known/assetlinks.json</code> resolves to the file you just uploaded.</p>
<h4 id="jekyll-based-websites">Jekyll based websites</h4>
<p>If your website is generated by Jekyll (such as GitHub Pages), you’ll need to add a line of configuration so that the <code>.well-known</code> directory is included in the output. GitHub help has <a href="https://help.github.com/en/articles/files-that-start-with-an-underscore-are-missing">more information on this topic</a>. Create a file called <code>_config.yml</code> at the root of your site (or add to it if it already exists) and enter:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Folders with dotfiles are ignored by default.</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="fu">include:</span><span class="at"> </span><span class="kw">[</span>.well-known<span class="kw">]</span></a></code></pre></div>
<h3 id="adding-more-keys-adding-more-keys">Adding more keys {: #adding-more-keys }</h3>
<p>A Digital Asset Link file can contain more than one app, and for each app, it can contain more than one key. For example, to add a second key, just use the <a href="https://play.google.com/store/apps/details?id=dev.conn.assetlinkstool">Asset Link Tool</a> to determine the key and add it as a second entry to the <code>sha256_cert_fingerprints</code> field. The code in Chrome that parses this JSON is quite strict, so make sure you don’t accidentally add an extra comma at the end of the list.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb7-1" title="1"><span class="ot">[</span><span class="fu">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">&quot;relation&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;delegate_permission/common.handle_all_urls&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">&quot;namespace&quot;</span><span class="fu">:</span> <span class="st">&quot;android_app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="dt">&quot;package_name&quot;</span><span class="fu">:</span> <span class="st">&quot;com.appspot.pwa_directory&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">&quot;sha256_cert_fingerprints&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb7-7" title="7">      <span class="st">&quot;FA:2A:03:CB:38:9C:F3:BE:28:E3:CA:7F:DA:2E:FA:4F:4A:96:F3:BC:45:2C:08:A2:16:A1:5D:FD:AB:46:BC:9D&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="dt">&quot;relation&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;delegate_permission/common.handle_all_urls&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb7-13" title="13">    <span class="dt">&quot;namespace&quot;</span><span class="fu">:</span> <span class="st">&quot;android_app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="dt">&quot;package_name&quot;</span><span class="fu">:</span> <span class="st">&quot;com.appspot.pwa_directory&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="dt">&quot;sha256_cert_fingerprints&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb7-16" title="16">      <span class="st">&quot;4F:FF:49:FF:C6:1A:22:E3:BB:6F:E6:E1:E6:5B:40:17:55:C0:A9:F9:02:D9:BF:28:38:0B:AE:A7:46:A0:61:8C&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="fu">}</span><span class="ot">]</span></a></code></pre></div>
<h2 id="troubleshooting-trouble-shooting">Troubleshooting {: trouble-shooting }</h2>
<h3 id="viewing-relevant-logs-viewing-relevant-logs">Viewing relevant logs {: viewing-relevant-logs }</h3>
<p>Chrome logs the reason that Digital Asset Links verification fails and you can view the logs on an Android device with <code>adb logcat</code>. If you’re developing on Linux/Mac, you can see the relevant logs from a connected device with:</p>
<pre class="shell"><code>&gt; adb logcat -v brief | grep -e OriginVerifier -e digital_asset_links</code></pre>
<p>For example, if you see the message <code>Statement failure matching fingerprint.</code>, you should use the Asset Link Tool to see your app’s signature and make sure it matches that in your <code>assetlinks.json</code> file (Be wary of confusing your debug and release keys. Look at the <a href="#a-note-on-signing-keys">A note on signing keys</a> section.)</p>
<h3 id="checking-your-browser-checking-your-browser">Checking your browser {: #checking-your-browser }</h3>
<p>A Trusted Web Activity will try to adhere to the user’s default choice of browser. If the user’s default browser supports Trusted Web Activities, it will be launched. Failing that, if any installed browser supports Trusted Web Activities, it will be chosen. Finally, the default behavior is to fall back to a Custom Tabs mode.</p>
<p>This means that if you’re debugging something to do with Trusted Web Activities, you should make sure you’re using the browser you think that you are. You can use the following command to check which browser is being used:</p>
<pre class="shell"><code>&gt; adb logcat -v brief | grep -e TWAProviderPicker
D/TWAProviderPicker(17168): Found TWA provider, finishing search: com.google.android.apps.chrome</code></pre>
<h2 id="next-steps-next-steps">Next Steps {: #next-steps }</h2>
<p>Hopefully, if you’ve followed this guide, you’ll have a working Trusted Web Activity and have enough knowledge to debug what’s going on when verification fails. If not, please have a look at the Troubleshooting section or file a GitHub issue against <a href="https://github.com/google/WebFundamentals/issues">these docs</a>.</p>
<p>For your next steps, I’d recommend you start off by <a href="https://developer.android.com/studio/write/image-asset-studio#launcher">creating an icon for your app</a>. With that done, you can consider deploying your app to the Play Store.</p>
</body>
</html>
