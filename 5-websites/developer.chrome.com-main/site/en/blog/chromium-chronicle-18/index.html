<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2021-02-22" />
  <title>The Chromium Chronicle #18: Chromium Code Coverage</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">The Chromium Chronicle #18: Chromium Code Coverage</h1>
<p class="date">2021-02-22</p>
</header>
<p><strong>Episode 18:</strong> by Veenita Joshi and Prakhar Asthana in Mountain View, CA (February 2021)<br> <a href="/tags/chromium-chronicle/">Previous episodes</a></p>
<p><strong>Test coverage measures how much source code is executed</strong> when a particular test suite runs. Generating coverage data has three major steps: compiling with instrumentation, gathering data from running instrumented tests, and post-processing the data. The coverage team has tools to automate this process.</p>
<p>The <a href="https://chromium.googlesource.com/chromium/src/+/master/tools/code_coverage/coverage.py">Coverage script</a> <strong>can generate code coverage reports in just one command</strong>, without waiting for <a href="/blog/chromium-chronicle-3/">Gerrit UI to be updated</a>. This script is currently supported on Linux, Mac, iOS and ChromeOS.</p>
<p>Here is a sample usage:</p>
<pre class="shell"><code>$ gn gen out/coverage \
    --args=&#39;use_clang_coverage=true is_component_build=false&#39;
$ python tools/code_coverage/coverage.py \
    crypto_unittests url_unittests \
    -b out/coverage -o out/report \
    -c &#39;out/coverage/crypto_unittests&#39; \
    -c &#39;out/coverage/url_unittests --gtest_filter=URLParser.PathURL&#39; \
    -f url/ -f crypto/</code></pre>
<p>This builds and runs the <code>crypto_unittests</code> and <code>url_unittests targets</code>. For <code>url_unittests</code>, it only runs the test <code>URLParser.PathURL</code>. The coverage report is filtered to include only files and sub-directories under <code>url/</code> and <code>crypto/</code>. Aside from automating the process, <strong>this script provides additional features to view code coverage by directories and components</strong>.</p>
<p>{% Columns %}</p>
<p>{% Column %} {% Img src=“image/0g2WvpbGRGdVs0aAPc6ObG7gkud2/so1zrd3pzjk0SO9lu7jQ.png”, alt=“Screenshot of output from coverage script.”, width=“800”, height=“161” %} Directory View {% endColumn %}</p>
<p>{% Column %} {% Img src=“image/0g2WvpbGRGdVs0aAPc6ObG7gkud2/I1c23lIHLlbsciym2aX4.png”, alt=“Screenshot of output from coverage script.”, width=“800”, height=“161” %} Component View {% endColumn %}</p>
<p>{% endColumns %}</p>
<p>The <a href="https://analysis.chromium.org/p/chromium/coverage/dir?host=chromium.googlesource.com&amp;project=chromium/src&amp;ref=refs/heads/master&amp;revision=fda1eab599aa18a4731275a74385c13d546bb7f6&amp;path=//this/path/is/set/&amp;platform=linux">Code Coverage tool</a> provides a code coverage breakdown by directory and component for the whole codebase, for Windows, iOS, Android, Linux and Chrome OS.</p>
<p><strong>Share your feedback:</strong> Contact <code>code-coverage @ chromium.org</code> or file a bug on <a href="https://bugs.chromium.org/p/chromium/issues/entry?labels=Pri-3&amp;status=Unconfirmed&amp;components=Infra%3ETest%3ECodeCoverage&amp;comment=what%27s+the+bug+or+feature%3F">crbug.com</a>.</p>
<h2 id="resources">Resources</h2>
<ul>
<li>See the <a href="https://analysis.chromium.org/p/chromium/coverage">code coverage for the whole codebase</a> and a breakdown by directories and components.</li>
</ul>
</body>
</html>
