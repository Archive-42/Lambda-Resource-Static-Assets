<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2021-04-21" />
  <title>Aligning timers with cross origin isolation restrictions</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Aligning timers with cross origin isolation restrictions</h1>
<p class="date">2021-04-21</p>
</header>
<p>Before version 91, <a href="https://www.w3.org/TR/hr-time/">timer resolutions</a> in Chrome were restricted to 5 microseconds on desktop, where <a href="https://www.chromium.org/Home/chromium-security/site-isolation">site-isolation</a> is enabled, and to 100 microseconds on Android, where it’s not.</p>
<p>Starting from version 91, following a <a href="https://github.com/w3c/hr-time/pull/93">specification change</a>, Chrome will be restricting the resolution of explicit <a href="https://www.w3.org/TR/hr-time/">timers</a> (<code>performance.now()</code>, <code>performance.timeOrigin()</code>, and other performance APIs that expose <code>DOMHighResTimestamps</code>) to 100 microseconds across platforms. By enabling <a href="https://web.dev/coop-coep/">cross-origin isolation</a>, websites can relax the restriction to 5 microseconds regardless of platform.</p>
<p>{% Aside %} A microsecond is one millionth of a second (0.000001 seconds). Therefore, 5 microseconds is 0.000005 seconds. {% endAside %}</p>
<p>Gaining more powerful capabilities by enabling cross-origin isolation is <a href="/blog/enabling-shared-array-buffer/">a similar approach posed on <code>SharedArrayBuffer</code></a>. Cross-origin isolation is a state where a web page is isolated from other origins except ones that opted-in.</p>
<h2 id="do-i-need-to-do-something-about-it">Do I need to do something about it?</h2>
<p>Probably not. <code>performance.now()</code> has been limited to significantly more coarse resolutions in other browsers (for example, 1 millisecond = 0.001 seconds), so you shouldn’t have relied on the current resolution anyway.</p>
<p>At the same time, if you wish to benefit from higher resolution for your timers, for example for more accurate performance measurements, you would need to make sure your site is <a href="https://web.dev/coop-coep">cross-origin isolated</a>. That would provide you with better resolution both in Chrome and other Chromium based browsers, <a href="https://github.com/mozilla/standards-positions/issues/502#issuecomment-801003513">as well as Firefox</a>.</p>
<h2 id="what-do-timers-have-to-do-with-cross-origin-isolation">What do timers have to do with cross-origin isolation?</h2>
<p>Browser vendors decided to limit the timers to more coarse resolutions (as well as the availability of SharedArrayBuffers which can be used as implicit timers) when <a href="https://en.wikipedia.org/wiki/Spectre_(security_vulnerability)">Spectre</a> was discovered. This is because Spectre, and similar speculative execution attacks, rely on timers to measure the time certain operations take, then guess the contents of the process’ memory.</p>
<p>While speculative execution attacks can be executed with coarse timers, high-resolution timers can speed them up. Chrome used its <a href="https://www.chromium.org/Home/chromium-security/site-isolation">site-isolation</a> architecture, as well as other <a href="https://www.chromium.org/Home/chromium-security/corb-for-developers">mechanisms</a>, to mitigate the risk and re-enabled those functionalities, but it is limited to desktop platforms and Chromium browsers only. Having APIs relying on the underlying browser architecture isn’t really ideal.</p>
<p>Cross-origin isolation provides the standard baseline for browsers to run pages in an isolated environment such that they are unable to load unwilling cross-origin resources, and therefore, are not at risk for Spectre. With cross-origin isolation, we can now allow pages to access high-resolution timers, <code>SharedArrayBuffer</code>, and other APIs that are unsafe to expose in processes that can read arbitrary cross-origin data.</p>
<p>To learn more about the background behind this change, read <a href="https://web.dev/why-coop-coep/">Why you need “cross-origin isolated” for powerful features</a>.</p>
<p>Cover photo by <a href="https://unsplash.com/@linper?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Linda Perez Johannessen</a> on <a href="https://unsplash.com/s/photos/stopwatch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>.</p>
</body>
</html>
