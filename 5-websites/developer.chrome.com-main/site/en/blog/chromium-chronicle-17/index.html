<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2021-01-26" />
  <title>The Chromium Chronicle #17: Browser Test Mixins</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">The Chromium Chronicle #17: Browser Test Mixins</h1>
<p class="date">2021-01-26</p>
</header>
<p><strong>Episode 17:</strong> by Toby Huang in San Francisco, CA (January 2021)<br> <a href="/tags/chromium-chronicle/">Previous episodes</a></p>
<p>Browser tests are a form of automated testing for chromium code that are more end-to-end than unit tests. Browser tests create browser instances and test various UI elements instead of just testing pure input/output functionality like unit tests do. Integrated automated testing is important for simulating the user’s end-to-end experience. When writing a browser test, you often want to programmatically perform setup actions that the user could do manually. To help you do this, <strong>mixins are a suite of tools for performing non-trivial browser test setup in a reusable way.</strong></p>
<p>Examples of useful mixins:</p>
<ul>
<li><code>GuestUserMixin</code> for testing incognito mode</li>
<li><code>UserPolicyMixin</code> for mocking user policy from the server</li>
<li><code>FakeGaiaMixin</code> for mocking responses from the Gaia server</li>
</ul>
<p><strong>You can create your own custom mixins</strong> to serve a wide variety of purposes!</p>
<p>The snippet below logs in as a guest user for your test. It is important to <strong>make sure your feature works in incognito mode.</strong></p>
<p>{% Compare ‘better’ %}</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> MyGuestBrowserTestClass : <span class="kw">public</span> MixinBasedInProcessBrowserTest {</a>
<a class="sourceLine" id="cb1-2" title="2"> <span class="kw">private</span>:</a>
<a class="sourceLine" id="cb1-3" title="3">  GuestSessionMixin <span class="va">guest_session_mixin_</span>{&amp;<span class="va">mixin_host_</span>};</a>
<a class="sourceLine" id="cb1-4" title="4">};</a></code></pre></div>
<p>{% endCompare %}</p>
<p><code>LoggedInUserMixin</code> is a convenient way to log in as a Family Link user for your test. If your feature affects anything related to child supervision, you should <strong>test your feature for supervised users</strong>. A possible bug is forgetting that child users have incognito mode disabled or can’t install extensions without parent approval. <code>LoggedInUserMixin</code> is a compound mixin composed of other mixins.</p>
<p>{% Compare ‘better’ %}</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span> MyChildBrowserTestClass : <span class="kw">public</span> MixinBasedInProcessBrowserTest {</a>
<a class="sourceLine" id="cb2-2" title="2"> <span class="kw">protected</span>:</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">void</span> SetUpOnMainThread() <span class="kw">override</span> {</a>
<a class="sourceLine" id="cb2-4" title="4">    MixinBasedInProcessBrowserTest::SetUpOnMainThread();</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="va">logged_in_user_mixin_</span>.LogInUser();</a>
<a class="sourceLine" id="cb2-6" title="6">  }</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"> <span class="kw">private</span>:</a>
<a class="sourceLine" id="cb2-9" title="9">  LoggedInUserMixin <span class="va">logged_in_user_mixin_</span>{&amp;<span class="va">mixin_host_</span>,</a>
<a class="sourceLine" id="cb2-10" title="10">                                          LoggedInUserMixin::LogInType::kChild,</a>
<a class="sourceLine" id="cb2-11" title="11">                                          embedded_test_server(), <span class="kw">this</span>};</a>
<a class="sourceLine" id="cb2-12" title="12">};</a></code></pre></div>
<p>{% endCompare %}</p>
<p>One of the primary benefits of mixins is <strong>using composition instead of inheritance, and avoiding problems with diamond multiple inheritance</strong>. Inheriting from more than one test base class leads to the diamond problem, but you can mix and match mixins while avoiding this issue. Using mixins doesn’t entirely get rid of inheritance because the browser test class still needs to inherit from <code>MixinBasedInProcessBrowserTest</code>, but fortunately that base class is general-purpose and lightweight.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/login/user_types.md">User types in Chromium and ChromiumOS</a></li>
</ul>
</body>
</html>
