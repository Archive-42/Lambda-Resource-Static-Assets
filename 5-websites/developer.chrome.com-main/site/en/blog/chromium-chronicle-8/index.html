<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2019-11-26" />
  <title>The Chromium Chronicle #8: GWP-ASan: Detect bugs in the wild</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">The Chromium Chronicle #8: GWP-ASan: Detect bugs in the wild</h1>
<p class="date">2019-11-26</p>
</header>
<p><strong>Episode 8:</strong> by Vlad Tsyrklevich in Seattle, WA (November, 2019)<br> <a href="/tags/chromium-chronicle/">Previous episodes</a></p>
<p>Debugging memory safety errors, such as use-after-frees or buffer overflows, can be difficult. Tools like AddressSanitizer (ASan) are helpful to pinpoint memory errors in unit tests and fuzzers, but many bugs only manifest after deployment to users where ASan’s overhead is prohibitively high.</p>
<p><strong><a href="https://chromium.googlesource.com/chromium/src/+/lkgr/docs/gwp_asan.md">GWP-ASan</a> is a heap-only memory error detector designed to be used in the wild.</strong> It detects use-after-frees, buffer overflows/underflows, and double frees. Unlike ASan, it does not detect errors on the stack or in globals.</p>
<p>By sampling a tiny percentage of allocations, GWP-ASan is able to provide probabilistic error detection with negligible memory and performance overhead. <strong>GWP-ASan will cause the process to crash immediately when a memory error occurs</strong> with a sampled allocation. This makes it easier to spot the bug as the crash happens right where the error is made instead of at some later point when corrupt memory is used.</p>
<p>Like ASan, <strong>GWP-ASan crash reports include allocation and deallocation stack traces</strong> to help debug memory issues. Let’s take a look at an example (<a href="https://crbug.com/956230">crbug/956230</a>) of some of the additional data presented in the crash UI:</p>
<p>{% Img src=“image/0g2WvpbGRGdVs0aAPc6ObG7gkud2/7YXBJMmqzpQo9zTwm2vI.png”, alt="“, height=”192“, width=”800" %}</p>
<p>{% Img src=“image/0g2WvpbGRGdVs0aAPc6ObG7gkud2/PVJMCXodiEt6PrCHIqOc.png”, alt="“, height=”206“, width=”800" %}</p>
<p>The use and deallocation both originate in <code>PDFiumEngine::ExtendSelection()</code>. The source quickly shows the bug is a use of an invalidated <code>std::vector</code> iterator.</p>
<p><strong>GWP-ASan is enabled on the stable channel for allocations made using <code>malloc</code>/<code>new</code> and <code>PartitionAlloc</code></strong> on Windows and macOS. Android support is in progress. Over 60 GWP-ASan bugs have been reported so far and about 70% have been fixed. GWP-ASan crashes are all candidate security issues that may be exploitable so please triage them quickly and request backports where necessary.</p>
</body>
</html>
