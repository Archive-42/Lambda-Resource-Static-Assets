<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.es</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="proyecto-de-extensión-del-navegador-parte-3-más-información-sobre-el-rendimiento-y-las-tareas-en-segundo-plano">Proyecto de extensión del navegador, parte 3: Más información sobre el rendimiento y las tareas en segundo plano</h1>
<h2 id="pre-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/27">Pre-lecture prueba</a></h2>
<h3 id="introducción">Introducción:</h3>
<p>En las dos últimas lecciones de este módulo, aprendió cómo crear un formulario y un área de visualización para los datos obtenidos de una API. Es una forma muy estándar de crear presencias web en la web. Incluso aprendió a manejar la obtención de datos de forma asincrónica. La extensión de su navegador está casi completa.</p>
<p>Queda por administrar algunas tareas en segundo plano, incluida la actualización del color del icono de la extensión, por lo que este es un buen momento para hablar sobre cómo el navegador administra este tipo de tareas. Pensemos en estas tareas del navegador en el contexto del rendimiento de sus activos web a medida que los crea.</p>
<h2 id="conceptos-básicos-sobre-el-rendimiento-web">Conceptos básicos sobre el rendimiento web</h2>
<blockquote>
<p>“El rendimiento del sitio web se trata de dos cosas: qué tan rápido se carga la página y qué tan rápido se ejecuta el código”. - <a href="https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/">Zack Grossbart</a></p>
</blockquote>
<p>El tema de cómo hacer que sus sitios web sean increíblemente rápidos en todo tipo de dispositivos, para todo tipo de usuarios, en todo tipo de situaciones, es sorprendentemente vasto. Estos son algunos puntos que debe tener en cuenta al crear un proyecto web estándar o una extensión de navegador.</p>
<p>Lo primero que debe hacer para asegurarse de que su sitio funcione de manera eficiente es recopilar datos sobre su rendimiento. El lugar para hacer esto es en las herramientas de desarrollo de su navegador web. En Edge, puede seleccionar los tres puntos en la parte superior derecha del navegador, luego navegar a Más herramientas&gt; Herramientas de desarrollo y abrir la pestaña Rendimiento.</p>
<p>La pestaña Rendimiento contiene una herramienta de creación de perfiles. Abra un sitio web (pruebe, por ejemplo, https://www.microsoft.com) y haga clic en el botón ‘Grabar’, luego actualice el sitio. Detenga la grabación en cualquier momento y podrá ver las rutinas que se generan para ‘escribir’, ‘renderizar’ y ‘pintar’ el sitio:</p>
<figure>
<img src="./images/profiler.png" alt="Edge profiler" /><figcaption>Edge profiler</figcaption>
</figure>
<p>✅ Visite la <a href="https://docs.microsoft.com/microsoft-edge/devtools-guide/performance?WT.mc_id=academic-13441-cxa">Documentación de Microsoft</a> en el panel Rendimiento en Edge</p>
<blockquote>
<p>Consejo: para obtener una lectura real de la hora de inicio de su sitio web, borre la memoria caché de su navegador</p>
</blockquote>
<p>Seleccione elementos de la línea de tiempo del perfil para ampliar los eventos que suceden mientras se carga su página.</p>
<p>Obtenga una instantánea del rendimiento de su página seleccionando una parte de la línea de tiempo del perfil y mirando el panel de resumen:</p>
<figure>
<img src="./images/snapshot.png" alt="Instantánea de Edge Profiler" /><figcaption>Instantánea de Edge Profiler</figcaption>
</figure>
<p>Compruebe el panel Registro de eventos para ver si algún evento tardó más de 15 ms:</p>
<figure>
<img src="./images/log.png" alt="Registro de eventos de Edge" /><figcaption>Registro de eventos de Edge</figcaption>
</figure>
<p>✅ ¡Conoce a tu perfilador! Abra las herramientas de desarrollo en este sitio y vea si hay cuellos de botella. ¿Cuál es el activo de carga más lenta? ¿El más rápido?</p>
<h2 id="comprobaciones-de-perfiles">Comprobaciones de perfiles</h2>
<p>En general, hay algunas “áreas problemáticas” que todo desarrollador web debe tener en cuenta al crear un sitio, para evitar sorpresas desagradables cuando llegue el momento de implementarlo en producción.</p>
<p><strong>Tamaños de activos</strong>: la Web se ha vuelto ‘más pesada’ y, por lo tanto, más lenta en los últimos años. Parte de este peso tiene que ver con el uso de imágenes.</p>
<p>✅ Busque en el <a href="https://httparchive.org/reports/page-weight">Archivo de Internet</a> una vista histórica del peso de la página y más.</p>
<p>Una buena práctica es asegurarse de que sus imágenes estén optimizadas, entregadas con el tamaño y la resolución adecuados para sus usuarios.</p>
<p><strong>Recorridos de DOM</strong>: el navegador tiene que construir su Modelo de Objetos de Documento basado en el código que usted escribe, por lo que es de interés para un buen rendimiento de la página mantener sus etiquetas al mínimo, solo usando y estilizando lo que la página necesita. Hasta este punto, se podría optimizar el exceso de CSS asociado con una página; los estilos que deben usarse solo en una página no necesitan incluirse en la hoja de estilo principal, por ejemplo.</p>
<p><strong>JavaScript</strong>: Todo desarrollador de JavaScript debe estar atento a los scripts de ‘bloqueo de renderizado’ que deben cargarse antes de que el resto del DOM pueda atravesarse y pintarse en el navegador. Considere usar “diferir” con sus scripts en línea (como se hace en el módulo Terrarium).</p>
<p>✅ Pruebe algunos sitios en un <a href="https://www.webpagetest.org/">sitio web de prueba de velocidad del sitio</a> para obtener más información sobre las comprobaciones comunes que se realizan para determinar el rendimiento del sitio.</p>
<p>Ahora que tiene una idea de cómo el navegador representa los recursos que le envía, veamos las últimas cosas que debe hacer para completar su extensión:</p>
<h3 id="crea-una-función-para-calcular-el-color">Crea una función para calcular el color</h3>
<p>Trabajando en <code>/ src / index.js</code>, agregue una función llamada<code>calculateColor ()</code>después de la serie de variables<code>const</code> que estableció para obtener acceso al DOM:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">function</span> <span class="at">calculateColor</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="kw">let</span> co2Scale <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">150</span><span class="op">,</span> <span class="dv">600</span><span class="op">,</span> <span class="dv">750</span><span class="op">,</span> <span class="dv">800</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">let</span> colors <span class="op">=</span> [<span class="st">&#39;#2AA364&#39;</span><span class="op">,</span> <span class="st">&#39;#F5EB4D&#39;</span><span class="op">,</span> <span class="st">&#39;#9E4229&#39;</span><span class="op">,</span> <span class="st">&#39;#381D02&#39;</span><span class="op">,</span> <span class="st">&#39;#381D02&#39;</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">let</span> closestNum <span class="op">=</span> <span class="va">co2Scale</span>.<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-6" title="6">        <span class="cf">return</span> <span class="va">Math</span>.<span class="at">abs</span>(a <span class="op">-</span> value) <span class="op">-</span> <span class="va">Math</span>.<span class="at">abs</span>(b <span class="op">-</span> value)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="op">}</span>)[<span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="va">console</span>.<span class="at">log</span>(value <span class="op">+</span> <span class="st">&#39; is closest to &#39;</span> <span class="op">+</span> closestNum)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="kw">let</span> num <span class="op">=</span> (element) <span class="kw">=&gt;</span> element <span class="op">&gt;</span> closestNum<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="kw">let</span> scaleIndex <span class="op">=</span> <span class="va">co2Scale</span>.<span class="at">findIndex</span>(num)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">let</span> closestColor <span class="op">=</span> colors[scaleIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="va">console</span>.<span class="at">log</span>(scaleIndex<span class="op">,</span> closestColor)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">sendMessage</span>(<span class="op">{</span> <span class="dt">action</span><span class="op">:</span> <span class="st">&#39;updateIcon&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="op">{</span> <span class="dt">color</span><span class="op">:</span> closestColor <span class="op">}</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="op">}</span></a></code></pre></div>
<p>¿Que está pasando aqui? Pasa un valor (la intensidad de carbono) de la llamada API que completó en la última lección, y luego calcula qué tan cerca está su valor del índice presentado en la matriz de colores. Luego, envía el valor de color más cercano al tiempo de ejecución de Chrome.</p>
<p>Chrome.runtime tiene <a href="https://developer.chrome.com/extensions/runtime">una API</a> que maneja todo tipo de tareas en segundo plano, y tu extensión aprovecha eso:</p>
<blockquote>
<p>“Utilice la API chrome.runtime para recuperar la página de fondo, devolver detalles sobre el manifiesto y escuchar y responder a eventos en el ciclo de vida de la aplicación o extensión. También puede utilizar esta API para convertir la ruta relativa de las URL a URL calificadas”.</p>
</blockquote>
<p>✅ Si está desarrollando esta extensión de navegador para Edge, puede que le sorprenda que esté utilizando una API de Chrome. Las versiones más recientes del navegador Edge se ejecutan en el motor del navegador Chromium, por lo que puede aprovechar estas herramientas.</p>
<blockquote>
<p>Tenga en cuenta que si desea crear un perfil de una extensión de navegador, inicie las herramientas de desarrollo desde la propia extensión, ya que es su propia instancia de navegador independiente.</p>
</blockquote>
<h3 id="establecer-un-color-de-icono-predeterminado">Establecer un color de icono predeterminado</h3>
<p>Ahora, en la función <code>init ()</code>, configure el ícono en verde genérico para comenzar nuevamente llamando a la acción <code>updateIcon</code> de Chrome:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">sendMessage</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">action</span><span class="op">:</span> <span class="st">&#39;updateIcon&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="dt">value</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">            <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;green&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="op">},</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="llame-a-la-función-ejecute-la-llamada">Llame a la función, ejecute la llamada</h3>
<p>A continuación, llame a la función que acaba de crear agregándola a la promesa devuelta por la API C02Signal:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="co">//let CO2...</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="at">calculateColor</span>(CO2)<span class="op">;</span></a></code></pre></div>
<p>Y finalmente, en <code>/dist/background.js</code>, agregue el oyente para estas llamadas de acción en segundo plano:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onMessage</span>.<span class="at">addListener</span>(<span class="kw">function</span> (msg<span class="op">,</span> sender<span class="op">,</span> sendResponse) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">&#39;updateIcon&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="va">chrome</span>.<span class="va">browserAction</span>.<span class="at">setIcon</span>(<span class="op">{</span> <span class="dt">imageData</span><span class="op">:</span> <span class="at">drawIcon</span>(<span class="va">msg</span>.<span class="at">value</span>) <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">//tomado de la extensión Energy Lollipop, ¡buena característica!</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">function</span> <span class="at">drawIcon</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="kw">let</span> canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="kw">let</span> context <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="va">context</span>.<span class="at">beginPath</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="va">context</span>.<span class="at">fillStyle</span> <span class="op">=</span> <span class="va">value</span>.<span class="at">color</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="va">context</span>.<span class="at">arc</span>(<span class="dv">100</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="va">context</span>.<span class="at">fill</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="cf">return</span> <span class="va">context</span>.<span class="at">getImageData</span>(<span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="op">}</span></a></code></pre></div>
<p>En este código, está agregando un oyente para cualquier mensaje que llegue al administrador de tareas de backend. Si se llama ‘updateIcon’, entonces se ejecuta el siguiente código para dibujar un icono del color adecuado usando la API de Canvas.</p>
<p>✅ Aprenderá más sobre la API Canvas en las <a href="../../space-game/drawing-to-canvas/README.md">lecciones del juego espacial</a>.</p>
<p>Ahora, reconstruya su extensión (<code>npm run build</code>), actualice y ejecute su extensión, y observe el cambio de color. ¿Es un buen momento para hacer un mandado o lavar los platos? ¡Ahora lo sabes!</p>
<p>Felicitaciones, ha creado una extensión de navegador útil y ha aprendido más sobre cómo funciona el navegador y cómo perfilar su rendimiento.</p>
<p>🚀 Desafío: Investigue algunos sitios web de código abierto que han existido hace mucho tiempo y, según su historial de GitHub, vea si puede determinar cómo se optimizaron a lo largo de los años para el rendimiento, si es que lo hicieron. ¿Cuál es el punto de dolor más común?</p>
<h2 id="post-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/28">Post-lecture prueba</a></h2>
<h2 id="revisión-y-autoestudio">Revisión y autoestudio</h2>
<p>Considere suscribirse a un <a href="https://perf.email/">boletín informativo de rendimiento</a></p>
<p>Investigue algunas de las formas en que los navegadores miden el rendimiento web consultando las pestañas de rendimiento de sus herramientas web. ¿Encuentra diferencias importantes?</p>
<p><strong>Tarea</strong>: <a href="assignment.md">Analizar el rendimiento de un sitio</a></p>
</body>
</html>
