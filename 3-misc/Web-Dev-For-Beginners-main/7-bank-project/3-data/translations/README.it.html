<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.it</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="creazione-di-unapp-bancaria-parte-3-metodi-di-recupero-e-utilizzo-dati">Creazione di un’App Bancaria Parte 3: Metodi di Recupero e Utilizzo Dati</h1>
<h2 id="quiz-pre-lezione">Quiz Pre-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/45?loc=it">Quiz Pre-Lezione</a></p>
<h3 id="introduzione">Introduzione</h3>
<p>Al centro di ogni applicazione web ci sono i <em>dati</em>. I dati possono assumere molte forme, ma il loro scopo principale è sempre quello di mostrare le informazioni all’utente. Con le app web che diventano sempre più interattive e complesse, il modo in cui l’utente accede e interagisce con le informazioni è ora una parte fondamentale dello sviluppo web.</p>
<p>In questa lezione si vedrà come recuperare i dati da un server in modo asincrono e utilizzare questi dati per visualizzare le informazioni su una pagina web senza ricaricare l’HTML.</p>
<h3 id="prerequisito">Prerequisito</h3>
<p>Per questa lezinoe è necessario aver creato la parte <a href="../../2-forms/translations/README.it.md">Form di Accesso e Registrazione</a> dell’app web. È inoltre necessario installare <a href="https://nodejs.org">Node.js</a> ed eseguire <a href="../../api/translations/README.it.md">l’API del server</a> in locale in modo da ottenere i dati dell’account.</p>
<p>Si può verificare che il server funzioni correttamente eseguendo questo comando in un terminale:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">curl</span> http://localhost:5000/api</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># -&gt; dovrebbe restituire  &quot;Bank API v1.0.0&quot; come risultato</span></a></code></pre></div>
<hr />
<h2 id="ajax-e-recupero-dati">AJAX e recupero dati</h2>
<p>I siti Web tradizionali aggiornano il contenuto visualizzato quando l’utente seleziona un collegamento o invia dati utilizzando un form, ricaricando l’intera pagina HTML. Ogni volta che è necessario caricare nuovi dati, il server web restituisce una nuova pagina HTML che deve essere elaborata dal browser, interrompendo l’azione corrente dell’utente e limitando le interazioni durante il ricaricamento. Questo flusso di lavoro è anche chiamato <em>Applicazione MultiPagina</em> o <em>MPA</em> (Multi-Page Application) .</p>
<figure>
<img src="../images/mpa.png" alt="Aggiornare il flusso di lavoro in un’applicazione multipagina" /><figcaption>Aggiornare il flusso di lavoro in un’applicazione multipagina</figcaption>
</figure>
<p>Quando le applicazioni web hanno iniziato a diventare più complesse e interattive, è emersa una nuova tecnica chiamata <a href="https://it.wikipedia.org/wiki/AJAX">AJAX (Asynchronous JavaScript and XML)</a>). Questa tecnica consente alle app web di inviare e recuperare dati da un server in modo asincrono utilizzando JavaScript, senza dover ricaricare la pagina HTML, con conseguenti aggiornamenti più rapidi e interazioni utente più fluide. Quando vengono ricevuti nuovi dati dal server, la pagina HTML corrente può anche essere aggiornata con JavaScript utilizzando l’API <a href="https://developer.mozilla.org/it/docs/Web/API/Document_Object_Model">DOM</a>. Nel tempo, questo approccio si è evoluto in quella che ora viene chiamata <a href="https://it.wikipedia.org/wiki/Single-page_application"><em>Applicazione a Pagina Singola</em> o <em>SPA</em></a> (Single-Page Application).</p>
<figure>
<img src="../images/spa.png" alt="Aggiornare il flusso di lavoro in un’applicazione a pagina singola" /><figcaption>Aggiornare il flusso di lavoro in un’applicazione a pagina singola</figcaption>
</figure>
<p>Quando è stato introdotto per la prima volta AJAX, l’unica API disponibile per recuperare i dati in modo asincrono era <a href="https://developer.mozilla.org/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest"><code>XMLHttpRequest</code></a>. I browser moderni ora implementano anche l’<a href="https://developer.mozilla.org/it/docs/Web/API/Fetch_API">API Fetch</a>, più conveniente e potente, che utilizza le promesse ed è più adatta per manipolare i dati JSON.</p>
<blockquote>
<p>Sebbene tutti i browser moderni supportino l’<code>API Fetch</code>, se si desidera che la propria applicazione web funzioni su browser legacy o vecchi, è sempre una buona idea controllare prima la <a href="https://caniuse.com/fetch">tabella di compatibilità su caniuse.com</a>.</p>
</blockquote>
<h3 id="attività">Attività</h3>
<p><a href="../../2-forms/translations/README.it.md">Nella lezione precedente</a> si è implementato il form di registrazione per creare un account. Ora verrà aggiunto il codice per accedere utilizzando un account esistente e recuperarne i dati. Aprire il file <code>app.js</code> e aggiungere una nuova funzione di accesso (<code>login</code>):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">login</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">const</span> loginForm <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;loginForm&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">const</span> user <span class="op">=</span> <span class="va">loginForm</span>.<span class="va">user</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>Qui si inizia recuperando l’elemento form con <code>getElementById()</code>, quindi si ottiene il nome utente (user) dall’input con <code>loginForm.user.value</code>. È possibile accedere a ogni controllo del form tramite il suo nome (impostato nell’HTML utilizzando l’attributo <code>name</code>) come proprietà del form.</p>
<p>In modo simile a quanto fatto per la registrazione, verrà creata un’altra funzione per eseguire una richiesta al server, ma questa volta per recuperare i dati dell’account:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getAccount</span>(user) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(<span class="st">&#39;//localhost:5000/api/accounts/&#39;</span> <span class="op">+</span> <span class="at">encodeURIComponent</span>(user))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="cf">return</span> <span class="cf">await</span> <span class="va">response</span>.<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="op">}</span> <span class="cf">catch</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="cf">return</span> <span class="op">{</span> <span class="dt">error</span><span class="op">:</span> <span class="va">error</span>.<span class="at">message</span> <span class="op">||</span> <span class="st">&#39;Unknown error&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span></a></code></pre></div>
<p>Si usa l’API <code>fetch</code> per richiedere i dati in modo asincrono dal server, ma questa volta non servono parametri aggiuntivi oltre all’URL da chiamare, poiché si sta solo interrogando i dati. Per impostazione predefinita, <code>fetch</code> crea una richiesta HTTP <a href="https://developer.mozilla.org/docs/Web/HTTP/Methods/GET"><code>GET</code></a>, che è ciò che serve qui.</p>
<p>✅ <code>encodeURIComponent()</code> è una funzione che evita i caratteri speciali per l’URL. Quali problemi si potrebbero avere se non viene chiamata questa funzione e si utilizza direttamente il valore del campo <code>user</code> nell’URL?</p>
<p>Aggiornare ora la funzione <code>login</code> per utilizzare <code>getAccount</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">login</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">const</span> loginForm <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;loginForm&#39;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">const</span> user <span class="op">=</span> <span class="va">loginForm</span>.<span class="va">user</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="at">getAccount</span>(user)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="cf">if</span> (<span class="va">data</span>.<span class="at">error</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="cf">return</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;loginError&#39;</span><span class="op">,</span> <span class="va">data</span>.<span class="at">error</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">  account <span class="op">=</span> data<span class="op">;</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="at">navigate</span>(<span class="st">&#39;/dashboard&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="op">}</span></a></code></pre></div>
<p>Innanzitutto, poiché <code>getAccount</code> è una funzione asincrona, occorre associarla alla parola chiave <code>await</code> per attendere il risultato dal server. Come con qualsiasi richiesta al server, occorre anche gestire i casi di errore. Per ora si aggiungerà solo un messaggio di log per visualizzare l’errore e verrà indirizzato più tardi.</p>
<p>Quindi si deve memorizzare i dati da qualche parte in modo da poterli utilizzare in seguito per visualizzare le informazioni nel cruscotto. Poiché la variabile <code>account</code> non esiste ancora, verrà creata come variabile globale all’inizio del file:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">let</span> account <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a></code></pre></div>
<p>Dopo che i dati dell’utente sono stati salvati in una variabile, si può navigare dalla pagina di accessi (<em>login</em>) al cruscotto (<em>dashboard</em>) utilizzando la funzione <code>navigate()</code> che già esiste.</p>
<p>Infine, si deve chiamare la funzione <code>login</code> quando viene inviato il form di accesso, modificando l’HTML:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">&quot;loginForm&quot;</span><span class="ot"> action=</span><span class="st">&quot;javascript:login()&quot;</span><span class="kw">&gt;</span></a></code></pre></div>
<p>Verificare che tutto funzioni correttamente registrando un nuovo account e provando ad accedere utilizzando lo stesso account.</p>
<p>Prima di passare alla parte successiva, si può anche completare la funzione di registrazione (<code>register</code>) aggiungendola in fondo alla funzione:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1">account <span class="op">=</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="at">navigate</span>(<span class="st">&#39;/dashboard&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>✅ Si sa che per impostazione predefinita, si possono chiamare solo le API di un server che ha <em>stesso dominio e porta</em> della pagina web che si sta visualizzando? Questo è un meccanismo di sicurezza applicato dai browser. Un momento, la nostra app web è in esecuzione su <code>localhost:3000</code> mentre l’API del server è in esecuzione su <code>localhost:5000</code>, come mai funziona? Utilizzando una tecnica chiamata CORS <a href="https://developer.mozilla.org/it/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing</a>, è possibile eseguire richieste HTTP con diverse origini (cross-origin) se il server aggiunge intestazioni speciali alla risposta, consentendo eccezioni per domini specifici.</p>
<blockquote>
<p>Ulteriori informazioni sulle API sono disponibili seguendo questa <a href="https://docs.microsoft.com/learn/modules/use-apis-discover-museum-art?WT.mc_id=academic-4621-cxa">lezione</a></p>
</blockquote>
<h2 id="aggiornare-html-per-visualizzare-i-dati">Aggiornare HTML per visualizzare i dati</h2>
<p>Ora che si hanno i dati dell’utente, occorre aggiornare l’HTML esistente per visualizzarli. E’ già noto come recuperare un elemento dal DOM utilizzando ad esempio <code>document.getElementById()</code>. Dopo aver ottenuto un elemento base, ecco alcune API che si possono utilizzare per modificarlo o aggiungervi elementi figlio:</p>
<ul>
<li><p>Usando la proprietà <a href="https://developer.mozilla.org/docs/Web/API/Node/textContent"><code>textContent</code></a> si può cambiare il testo di un elemento. Notare che la modifica di questo valore rimuove tutti i figli dell’elemento (se presenti) e li sostituisce con il testo fornito. In quanto tale, è anche un metodo efficiente per rimuovere tutti i figli di un dato elemento assegnandogli una stringa vuota <code>""</code> .</p></li>
<li><p>Usando <a href="https://developer.mozilla.org/docs/Web/API/Document/createElement"><code>document.createElement()</code></a> insieme al metodo <a href="https://developer.mozilla.org/docs/Web/API/ParentNode/append"><code>append()</code></a> si può creare e allegare uno o più nuovi elementi figlio.</p></li>
</ul>
<p>✅ Utilizzando la proprietà <a href="https://developer.mozilla.org/docs/Web/API/Element/innerHTML"><code>innerHTML</code></a> di un elemento è anche possibile modificare il suo contenuto HTML, ma questo dovrebbe essere evitato poiché è vulnerabile agli attacchi di <a href="https://developer.mozilla.org/docs/Glossary/Cross-site_scripting">cross-site scripting (XSS)</a> .</p>
<h3 id="attività-1">Attività</h3>
<p>Prima di passare alla schermata del cruscotto, c’è ancora una cosa da fare nella pagina di accesso (<em>login</em>). Attualmente, se si prova ad accedere con un nome utente che non esiste, viene mostrato un messaggio nella console ma per un utente normale non cambia nulla e non sa cosa sta succedendo.</p>
<p>Si aggiunge ora un elemento segnaposto nel form di accesso dove si può visualizzare un messaggio di errore se necessario. Un buon posto sarebbe subito prima del pulsante (<code>&lt;button&gt;</code>) con testo Login:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb8-1" title="1">...</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;loginError&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">&lt;button&gt;</span>Login<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb8-4" title="4">...</a></code></pre></div>
<p>Questo elemento <code>&lt;div&gt;</code> è vuoto, il che significa che non verrà visualizzato nulla sullo schermo fino a quando non verrà aggiunto del contenuto. Occorre anche assegnarli un <code>ID</code> in modo da poterlo recuperare facilmente con JavaScript.</p>
<p>Tornare al file <code>app.js</code> e creare una nuova funzione di supporto <code>updateElement</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">function</span> <span class="at">updateElement</span>(id<span class="op">,</span> text) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw">const</span> element <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(id)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="va">element</span>.<span class="at">textContent</span> <span class="op">=</span> text<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>Questo è abbastanza semplice: dato un <em>ID</em> di un elemento e un <em>testo</em>, si aggiornerà il contenuto del testo dell’elemento DOM con l’<code>id</code> corrispondente. Si usa questo metodo al posto del precedente messaggio di errore nella funzione <code>login</code> :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="cf">if</span> (<span class="va">data</span>.<span class="at">error</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="cf">return</span> <span class="at">updateElement</span>(<span class="st">&#39;loginError&#39;</span><span class="op">,</span> <span class="va">data</span>.<span class="at">error</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>Ora se si prova ad accedere con un account non valido, si dovrebbe vedere qualcosa del genere:</p>
<figure>
<img src="../images/login-error.png" alt="Videata che mostra il messaggio di errore visualizzato durante l’accesso" /><figcaption>Videata che mostra il messaggio di errore visualizzato durante l’accesso</figcaption>
</figure>
<p>Ora si ha un testo di errore che viene visualizzato, ma se si prova con un lettore di schermo si noterà che non viene annunciato nulla. Affinché il testo che viene aggiunto dinamicamente a una pagina venga annunciato dai lettori di schermo, sarà necessario utilizzare qualcosa chiamato <a href="https://developer.mozilla.org/docs/Web/Accessibility/ARIA/ARIA_Live_Regions">Live Region</a>. Qui verrà utilizzato un tipo specifico di live region chiamato alert:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;loginError&quot;</span><span class="ot"> role=</span><span class="st">&quot;alert&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a></code></pre></div>
<p>Implementare lo stesso comportamento per gli errori della funzione <code>register</code> (non dimenticare di aggiornare l’HTML).</p>
<h2 id="visualizzare-le-informazioni-sulla-dashboard">Visualizzare le informazioni sulla dashboard</h2>
<p>Utilizzando le stesse tecniche appena viste, ci si occuperà anche di visualizzare le informazioni dell’account nella pagina del cruscotto.</p>
<p>Ecco come appare un oggetto account ricevuto dal server:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="st">&quot;test&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">&quot;currency&quot;</span><span class="fu">:</span> <span class="st">&quot;$&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Test account&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">&quot;balance&quot;</span><span class="fu">:</span> <span class="dv">75</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">&quot;transactions&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb12-7" title="7">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-01&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Pocket money&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">50</span> <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;2&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-03&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Book&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">-10</span> <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;3&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-04&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Sandwich&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">-5</span> <span class="fu">}</span></a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="fu">}</span></a></code></pre></div>
<blockquote>
<p>Nota: per semplificare, si può utilizzare l’account <code>test</code> preesistente già popolato di dati.</p>
</blockquote>
<h3 id="attività-2">Attività</h3>
<p>Iniziare sostituendo la sezione “Balance” (saldo) nell’HTML per aggiungere elementi segnaposto:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb13-2" title="2">  Balance: <span class="kw">&lt;span</span><span class="ot"> id=</span><span class="st">&quot;balance&quot;</span><span class="kw">&gt;&lt;/span&gt;&lt;span</span><span class="ot"> id=</span><span class="st">&quot;currency&quot;</span><span class="kw">&gt;&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">&lt;/section&gt;</span></a></code></pre></div>
<p>Si aggiungerà anche una nuova sezione appena sotto per visualizzare la descrizione dell’account:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">&lt;h2</span><span class="ot"> id=</span><span class="st">&quot;description&quot;</span><span class="kw">&gt;&lt;/h2&gt;</span></a></code></pre></div>
<p>✅ Poiché la descrizione del’account funge da titolo per il contenuto sottostante, viene contrassegnata semanticamente come intestazione (heading). Scoprire di più su come <a href="https://www.nomensa.com/blog/2017/how-structure-headings-web-accessibility">la struttura delle intestazioni</a> è importante per l’accessibilità ed esaminare la pagina per determinare cos’altro potrebbe essere un’intestazione.</p>
<p>Successivamente, verrà creata una nuova funzione in <code>app.js</code> per riempire il segnaposto:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">function</span> <span class="at">updateDashboard</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>account) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="cf">return</span> <span class="at">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="at">updateElement</span>(<span class="st">&#39;description&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="at">description</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="at">updateElement</span>(<span class="st">&#39;balance&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="va">balance</span>.<span class="at">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="at">updateElement</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="at">currency</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>Innanzitutto, controllare di avere i dati dell’account necessari prima di andare oltre. Quindi si usa la funzione <code>updateElement()</code> creata in precedenza per aggiornare l’HTML.</p>
<blockquote>
<p>Per rendere la visualizzazione del saldo più bella, si usa il metodo <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed"><code>toFixed(2)</code></a> per forzare la visualizzazione del valore con 2 cifre per la parte decimale.</p>
</blockquote>
<p>Ora occorre chiamare la funzione <code>updateDashboard()</code> ogni volta che viene caricato il cruscotto. Se si è già terminato il <a href="../../1-template-route/translations/assignment.it.md">compito della lezione 1</a> , questo dovrebbe essere immediato, altrimenti si può utilizzare la seguente implementazione.</p>
<p>Aggiungere questo codice alla fine della funzione <code>updateRoute()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="cf">if</span> (<span class="kw">typeof</span> <span class="va">route</span>.<span class="at">init</span> <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="va">route</span>.<span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>Aggiornare la definizione delle rotte con:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> routes <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="st">&#39;/login&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;login&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="st">&#39;/dashboard&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span><span class="op">,</span> <span class="dt">init</span><span class="op">:</span> updateDashboard <span class="op">}</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>Con questa modifica, ogni volta che viene visualizzata la pagina del cruscotto viene chiamata la funzione <code>updateDashboard()</code>. Dopo un accesso, si dovrebbe essere in grado di vedere il saldo del conto, la valuta e la descrizione.</p>
<h2 id="creare-righe-di-tabelle-dinamicamente-con-modelli-html">Creare righe di tabelle dinamicamente con modelli HTML</h2>
<p>Nella <a href="../../1-template-route/translations/README.it.md">prima lezione</a> sono stati utilizzati modelli HTML insieme al metodo <a href="https://developer.mozilla.org/docs/Web/API/Node/appendChild"><code>appendChild()</code></a> per implementare la navigazione nell’app. I modelli possono anche essere più piccoli e utilizzati per popolare dinamicamente parti ripetitive di una pagina.</p>
<p>Verrà usato un approccio simile per visualizzare l’elenco delle transazioni nella tabella HTML.</p>
<h3 id="attività-3">Attività</h3>
<p>Aggiungere un nuovo modello nell’elemento HTML <code>&lt;body&gt;</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;transaction&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-6" title="6">  <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<p>Questo modello rappresenta una singola riga di tabella, con le 3 colonne che si vuole popolare: <em>data</em>, <em>oggetto</em> e <em>importo</em> di una transazione.</p>
<p>Aggiungere quindi la proprietà <code>id</code> all’elemento <code>&lt;tbody&gt;</code> della tabella all’interno del modello del cruscotto per semplificare la ricerca dell’elemento utilizzando JavaScript:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">&lt;tbody</span><span class="ot"> id=</span><span class="st">&quot;transactions&quot;</span><span class="kw">&gt;&lt;/tbody&gt;</span></a></code></pre></div>
<p>L’HTML è pronto, ora si passa al codice JavaScript e si crea una nuova funzione <code>createTransactionRow</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">function</span> <span class="at">createTransactionRow</span>(transaction) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;transaction&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="kw">const</span> transactionRow <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="kw">const</span> tr <span class="op">=</span> <span class="va">transactionRow</span>.<span class="at">querySelector</span>(<span class="st">&#39;tr&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">0</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="at">date</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-6" title="6">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">1</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="at">object</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">2</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="va">amount</span>.<span class="at">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-8" title="8">  <span class="cf">return</span> transactionRow<span class="op">;</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>Questa funzione fa esattamente ciò che implica il suo nome: utilizzando il modello creato in precedenza, crea una nuova riga di tabella e riempie il suo contenuto utilizzando i dati della transazione. Verrà usata nella funzione <code>updateDashboard()</code> per popolare la tabella:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">const</span> transactionsRows <span class="op">=</span> <span class="va">document</span>.<span class="at">createDocumentFragment</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="cf">for</span> (<span class="kw">const</span> transaction <span class="kw">of</span> <span class="va">account</span>.<span class="at">transactions</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="kw">const</span> transactionRow <span class="op">=</span> <span class="at">createTransactionRow</span>(transaction)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="va">transactionsRows</span>.<span class="at">appendChild</span>(transactionRow)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="at">updateElement</span>(<span class="st">&#39;transactions&#39;</span><span class="op">,</span> transactionsRows)<span class="op">;</span></a></code></pre></div>
<p>Qui si utilizza il metodo <a href="https://developer.mozilla.org/docs/Web/API/Document/createDocumentFragment"><code>document.createDocumentFragment()</code></a> che crea un nuovo frammento DOM su cui si può lavorare, prima di collegarlo finalmente alla tabella HTML.</p>
<p>C’è ancora un’altra cosa da fare prima che questo codice possa funzionare, poiché la funzione <code>updateElement()</code> attualmente supporta solo contenuto di testo. Occorre cambiare un poco il suo codice:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">function</span> <span class="at">updateElement</span>(id<span class="op">,</span> textOrNode) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="kw">const</span> element <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(id)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="va">element</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span> <span class="co">// Rimuove tutti i figli</span></a>
<a class="sourceLine" id="cb22-4" title="4">  <span class="va">element</span>.<span class="at">append</span>(textOrNode)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>Si usa il metodo <a href="https://developer.mozilla.org/docs/Web/API/ParentNode/append"><code>append()</code></a> in quanto consente di allegare testo o <a href="https://developer.mozilla.org/docs/Web/API/Node">nodi DOM</a> a un elemento genitore, che è perfetto per tutti i casi d’uso.</p>
<p>Se si prova a utilizzare l’account <code>test</code> per accedere, ora si dovrebbe vedere un elenco di transazioni sul cruscotto 🎉.</p>
<hr />
<h2 id="sfida">🚀 Sfida</h2>
<p>Collaborare per far sembrare la pagina del cruscotto una vera app bancaria. Se è già stato definito lo stile della propria app, provare a utilizzare le <a href="https://developer.mozilla.org/docs/Web/CSS/Media_Queries">media query</a> per creare una <a href="https://developer.mozilla.org/docs/Web/Progressive_web_apps/Responsive/responsive_design_building_blocks">disposizione reattiva</a> che funzioni bene sia su dispositivi desktop che mobili.</p>
<p>Ecco un esempio di una pagina cruscotto con applicato uno stile:</p>
<figure>
<img src="../../images/screen2.png" alt="Videata di un risultato di esempio del cruscotto dopo l’applicazione dello stile" /><figcaption>Videata di un risultato di esempio del cruscotto dopo l’applicazione dello stile</figcaption>
</figure>
<h2 id="quiz-post-lezione">Quiz Post-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/46?loc=it">Quiz post-lezione</a></p>
<h2 id="compito">Compito</h2>
<p><a href="assignment.it.md">Refattorizzare e commentare il codice</a></p>
</body>
</html>
