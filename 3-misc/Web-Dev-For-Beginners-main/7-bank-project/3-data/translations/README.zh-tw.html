<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.zh-tw</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="建立銀行網頁應用程式-part-3取得並使用資料">建立銀行網頁應用程式 Part 3：取得並使用資料</h1>
<h2 id="課前測驗">課前測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/45?loc=zh_tw">課前測驗</a></p>
<h3 id="大綱">大綱</h3>
<p>每一個網頁應用程式的核心為<em>資料</em>。資料有很多種格式，但它們的目的都是為了顯示使用者需要的資訊。網頁應用程式變得高互動性與複雜，使用者如何取得內容並與之進行互動變成網頁開發重要的一環。</p>
<p>在這堂課中，我們會了解伺服器是如何非同步地取得資料，並在不重新載入 HTML 的情況下，利用這些資料顯示在網頁上。</p>
<h3 id="開始之前">開始之前</h3>
<p>你需要先完成系列課程 ── <a href="../../2-forms/translations/README.zh-tw.md">登入與註冊表單</a>。你還需要安裝 <a href="https://nodejs.org">Node.js</a> 並<a href="../../api/translations/README.zh-tw.md">執行伺服器 API</a>。</p>
<p>你可以測試伺服器是否運作正常，在終端機中輸入指令：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">curl</span> http://localhost:5000/api</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># -&gt; 會回傳結果 &quot;Bank API v1.0.0&quot;</span></a></code></pre></div>
<hr />
<h2 id="ajax-和取得資料">AJAX 和取得資料</h2>
<p>傳統的網頁在使用者點擊連結，或是提交表單資料時，重新載入全部的 HTML 頁面來更新網頁內容。每當資料要被更新時，伺服器就需要回傳全新的 HTML 頁面給瀏覽器處理，同時也干涉到使用者正在進行的動作，重新載入的機制也限制了許多互動功能。這種工作流程被稱為<em>多頁面應用程式(Multi-Page Application)</em>，簡稱 <em>MPA</em>。</p>
<figure>
<img src="../images/mpa.png" alt="多頁面應用程式的更新流程" /><figcaption>多頁面應用程式的更新流程</figcaption>
</figure>
<p>網頁應用程式變得更加複雜，促使新的技術問世：<a href="https://zh.wikipedia.org/wiki/AJAX">AJAX (Asynchronous JavaScript and XML)</a>。</p>
<p>這個技巧允許網頁應用程式使用 JavaScript 非同步地傳遞與接收伺服器的資料，不需要重新載入 HTML 頁面，也反映在更快速的更新速率與更流暢的使用者體驗。在接收伺服器的新資料時，目前的 HTML 頁面可以被 JavaScript 利用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">DOM</a> API 更新。自此之後，這種流程演變成現今的<a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8"><em>單一頁面應用程式(Single-Page Application)</em>，<em>SPA</em></a>。</p>
<figure>
<img src="../images/spa.png" alt="單一頁面應用程式的更新流程" /><figcaption>單一頁面應用程式的更新流程</figcaption>
</figure>
<p>在 AJAX 早期，唯一取得資料的 API 為 <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest"><code>XMLHttpRequest</code></a>。但當代的瀏覽器已經建立出更方便且強大的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"><code>Fetch</code> API</a>，它們使用 Promises 物件且更適合應用在 JSON 資料上。</p>
<blockquote>
<p>許多當代瀏覽器支援 <code>Fetch API</code>，如果你想確認你的網頁應用程式是否運作在舊款的瀏覽器，檢查<a href="https://caniuse.com/fetch">caniuse.com 上的相容性測試</a>是一個好方法。</p>
</blockquote>
<h3 id="課題">課題</h3>
<p>在<a href="../../2-forms/translations/README.zh-tw.md">前一堂課程中</a>，我們製作出註冊表單來建立新帳戶。現在我們來加入新程式，使用現有的帳戶登入，並取得其相關資料。開啟檔案 <code>app.js</code>並新增函式 <code>login</code>：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">login</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">const</span> loginForm <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;loginForm&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">const</span> user <span class="op">=</span> <span class="va">loginForm</span>.<span class="va">user</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>現在我們利用 <code>getElementById()</code> 接收表單元素，並藉由 <code>loginForm.user.value</code> 取得輸入框內的使用者名稱。每一個表單控制可以以各自名稱(即 HTML 內的 <code>name</code> 屬性)來存取。</p>
<p>就像我們為註冊帳戶作的事一樣，我們建立另一個函式來執行伺服器請求，但這次是為了取得帳戶資料：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getAccount</span>(user) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(<span class="st">&#39;//localhost:5000/api/accounts/&#39;</span> <span class="op">+</span> <span class="at">encodeURIComponent</span>(user))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="cf">return</span> <span class="cf">await</span> <span class="va">response</span>.<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="op">}</span> <span class="cf">catch</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="cf">return</span> <span class="op">{</span> <span class="dt">error</span><span class="op">:</span> <span class="va">error</span>.<span class="at">message</span> <span class="op">||</span> <span class="st">&#39;Unknown error&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span></a></code></pre></div>
<p>我們使用 <code>fetch</code> API 來向伺服器做非同步資料請求。這次我們不需要添加額外的參數，如網址，我們只詢問資料內容。預設上，<code>fetch</code> 建立出 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET"><code>GET</code></a> HTTP 請求，即我們想做的事情。</p>
<p>✅ 函式 <code>encodeURIComponent()</code> 可以轉換網址內的特殊字元。如果我們不呼叫這個函式，而是直接將 <code>user</code> 這項數值放入網址中，這會發生什麼問題？</p>
<p>讓我們來更新函式 <code>login</code>，使用 <code>getAccount</code>：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">login</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">const</span> loginForm <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;loginForm&#39;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">const</span> user <span class="op">=</span> <span class="va">loginForm</span>.<span class="va">user</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="at">getAccount</span>(user)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="cf">if</span> (<span class="va">data</span>.<span class="at">error</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="cf">return</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;loginError&#39;</span><span class="op">,</span> <span class="va">data</span>.<span class="at">error</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">  account <span class="op">=</span> data<span class="op">;</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="at">navigate</span>(<span class="st">&#39;/dashboard&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="op">}</span></a></code></pre></div>
<p>首先，<code>getAccount</code> 是一個非同步函式，它利用關鍵字 <code>await</code> 等待伺服器的回傳結果。就如其他伺服器請求一樣，我們也必須要處理錯誤的情況。現在我們只加錯誤訊息給這些情況，之後再回過頭解決這些問題。</p>
<p>接著，我們必須儲存資料，在之後可以輸出成儀表板的資訊。目前變數 <code>account</code> 還沒存在，我們建立它的全域變數在檔案最上方：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">let</span> account <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a></code></pre></div>
<p>在用戶資料存到變數中後，我們可以使用函式 <code>navigate()</code> 從<em>登入</em>頁面切換到<em>儀表板</em>頁面。</p>
<p>最後，在登入表單提交時，呼叫函式 <code>login</code>。修改 HTML 語法：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">&quot;loginForm&quot;</span><span class="ot"> action=</span><span class="st">&quot;javascript:login()&quot;</span><span class="kw">&gt;</span></a></code></pre></div>
<p>測試註冊功能，以及新註冊的帳戶的登入行為是否運作正常。</p>
<p>在進行下一步驟前，我們還必須完成函式 <code>register</code>。在此函式的最下方加入：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1">account <span class="op">=</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="at">navigate</span>(<span class="st">&#39;/dashboard&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>✅ 你知道在預設上，你只能從<em>同一個網域(domain)與連接埠(port)</em>的網頁呼叫伺服器 APIs嗎？這是瀏覽器強制性的安全機制。但我們的網頁應用程式在 <code>localhost:3000</code> 上執行，而伺服器 API 則在 <code>localhost:5000</code> 上執行。為什麼這樣能正常運作？利用<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">跨來源資源共用 (CORS)</a>，只要伺服器添加特殊的標頭檔到網頁回應中，我們就可以處理跨資源的 HTTP 請求，允許特殊的網域進行呼叫。</p>
<blockquote>
<p>藉由前往<a href="https://docs.microsoft.com/en-us/learn/modules/use-apis-discover-museum-art?WT.mc_id=academic-13441-cxa">此課程</a>學習更多有關 API 的資訊。</p>
</blockquote>
<h2 id="更新-html-顯示資料">更新 HTML 顯示資料</h2>
<p>現在取得完用戶資料，我們必須更新到現有的 HTML 上。我們已經知道如何接收 DOM 的元素，例子為 <code>document.getElementById()</code>。只要你有元素，這邊有一些 API 讓你修改，或是新增子元素上去：</p>
<ul>
<li><p>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent"><code>textContent</code></a> 屬性，你可以改變元素的文字內容。注意改變此數值會刪除它的所有子元素(若存在的話)，並以該文字內容來替換它。同時，這也是個有效的方法來刪去所有的子成員，只要賦予它空字串 <code>''</code>。</p></li>
<li><p>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement"><code>document.createElement()</code></a> 與 <a href="https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/append"><code>append()</code></a> 這兩方法，你可以建立並接上一到多個子元素成員。</p></li>
</ul>
<p>✅ 使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML"><code>innerHTML</code></a> 元素屬性也能改變 HTML 的內容，但這方法要避免使用。這可能會遭遇有關<a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">跨網站指令碼 (XSS)</a>的攻擊。</p>
<h3 id="課題-1">課題</h3>
<p>在來到儀表板畫面之前，我們還需要幫<em>登入</em>頁面加一件事。目前，如果你試著使用不存在的帳戶進行登入，訊息只會出現在命令欄中，而使用者不會發覺到任何事情改變，也不清楚網頁發生了什麼事。</p>
<p>我們在登入表單中新增顯示錯誤訊息的地方。最好的地方為登入按鈕 <code>&lt;button&gt;</code> 之前：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb8-1" title="1">...</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;loginError&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">&lt;button&gt;</span>Login<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb8-4" title="4">...</a></code></pre></div>
<p>這個 <code>&lt;div&gt;</code> 元素為空的，代表著畫面不會印出任何訊息，直到我們添加內容進去。我們還給了它 <code>id</code>，讓 JavaScript 可以容易地存取它。</p>
<p>回到檔案 <code>app.js</code>，建立新的補助函數 <code>updateElement</code>：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">function</span> <span class="at">updateElement</span>(id<span class="op">,</span> text) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw">const</span> element <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(id)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="va">element</span>.<span class="at">textContent</span> <span class="op">=</span> text<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>這條就很直觀：給定元素的 <em>id</em> 與 <em>text</em>，它會更新 DOM 元素內符合 <code>id</code> 條件的文字內容。我們也使用這個方法到前面 <code>login</code> 函式的錯誤訊息中：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="cf">if</span> (<span class="va">data</span>.<span class="at">error</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="cf">return</span> <span class="at">updateElement</span>(<span class="st">&#39;loginError&#39;</span><span class="op">,</span> <span class="va">data</span>.<span class="at">error</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>現在，試著以不合法的帳戶進行登入，你應該能看到像這樣的畫面：</p>
<figure>
<img src="../images/login-error.png" alt="登入出現錯誤訊息之截圖" /><figcaption>登入出現錯誤訊息之截圖</figcaption>
</figure>
<p>現在我們印出錯誤訊息，但螢幕報讀器並沒有做任何報讀。為了讓被動態加入的文字能被螢幕報讀器閱讀出來，我們需要使用 <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions">Live Region</a>。這邊我們使用一種 Live Region 的類型 alert：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;loginError&quot;</span><span class="ot"> role=</span><span class="st">&quot;alert&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a></code></pre></div>
<p>建立同樣的行為到函式 <code>register</code> 的錯誤訊息當中，也別忘了更新你的 HTML。</p>
<h2 id="在儀表板顯示資訊">在儀表板顯示資訊</h2>
<p>使用同樣的技巧，我們需要將帳戶資訊印在儀表板頁面中。</p>
<p>這是從伺服器接收到的帳戶資料物件：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="st">&quot;test&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">&quot;currency&quot;</span><span class="fu">:</span> <span class="st">&quot;$&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Test account&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">&quot;balance&quot;</span><span class="fu">:</span> <span class="dv">75</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">&quot;transactions&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb12-7" title="7">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-01&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Pocket money&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">50</span> <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;2&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-03&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Book&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">-10</span> <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;3&quot;</span><span class="fu">,</span> <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-10-04&quot;</span><span class="fu">,</span> <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="st">&quot;Sandwich&quot;</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">-5</span> <span class="fu">}</span></a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="fu">}</span></a></code></pre></div>
<blockquote>
<p>筆記：為了讓開發更加的容易，你可以使用已經存在資料的帳戶 <code>test</code>。</p>
</blockquote>
<h3 id="課題-2">課題</h3>
<p>我們開始置換掉 HTML 檔內的 “Balance” 區域，加入放置區：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb13-2" title="2">  Balance: <span class="kw">&lt;span</span><span class="ot"> id=</span><span class="st">&quot;balance&quot;</span><span class="kw">&gt;&lt;/span&gt;&lt;span</span><span class="ot"> id=</span><span class="st">&quot;currency&quot;</span><span class="kw">&gt;&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">&lt;/section&gt;</span></a></code></pre></div>
<p>我們還需要在下方新增區域來顯示帳戶資訊：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">&lt;h2</span><span class="ot"> id=</span><span class="st">&quot;description&quot;</span><span class="kw">&gt;&lt;/h2&gt;</span></a></code></pre></div>
<p>✅ 表示帳戶資訊的函式剛好為在內容的標題處，我們可以將它作為語義化的標頭。學習更多關於<a href="https://www.nomensa.com/blog/2017/how-structure-headings-web-accessibility">標頭結構</a>，它對於網頁親和力格外重要，也明顯地表達出頁面的標頭位置。</p>
<p>接著，我們在 <code>app.js</code> 檔案中加入新的函式來為放置區新增內容：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">function</span> <span class="at">updateDashboard</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>account) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="cf">return</span> <span class="at">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="at">updateElement</span>(<span class="st">&#39;description&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="at">description</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="at">updateElement</span>(<span class="st">&#39;balance&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="va">balance</span>.<span class="at">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="at">updateElement</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="va">account</span>.<span class="at">currency</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>首先，我們需要先檢查帳戶的資料。使用我們之前建立的函式 <code>updateElement()</code> 來更新 HTML 檔。</p>
<blockquote>
<p>為了讓帳戶餘額漂亮地呈現，我們使用 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed"><code>toFixed(2)</code></a> 這個方法，強迫數值只顯示到小數點第二位。</p>
</blockquote>
<p>現在，每當儀表板被載入時，我們就需要呼叫函式 <code>updateDashboard()</code>。如果你已經完成<a href="../../1-template-route/translations/assignment.zh-tw.md">課程一的作業</a>，就不需要額外做處理，不然你可以使用接下來的設定。</p>
<p>加入這段程式碼到函式 <code>updateRoute()</code> 的下方：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="cf">if</span> (<span class="kw">typeof</span> <span class="va">route</span>.<span class="at">init</span> <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="va">route</span>.<span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>並更新路由定義：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> routes <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="st">&#39;/login&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;login&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="st">&#39;/dashboard&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span><span class="op">,</span> <span class="dt">init</span><span class="op">:</span> updateDashboard <span class="op">}</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>做完這些更動後，當儀表板要被呈現時，函式 `updateDashboard() 就會被呼叫。在你登入後就能看到帳戶的描述、餘額與交易狀況。</p>
<h2 id="利用-html-模板動態建立表格列">利用 HTML 模板動態建立表格列</h2>
<p>在<a href="../../1-template-route/translations/README.zh-tw.md">第一堂課</a>中，我們使用 HTML 模板與方法 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild"><code>appendChild()</code></a> 來做出應用程式內的轉換。模板還能執行更小規模的行為，動態地改變一部份的頁面</p>
<p>我們使用類似的方式來顯示 HTML 表格中的交易清單。</p>
<h3 id="課題-3">課題</h3>
<p>加入新的模板到 HTML 的 <code>&lt;body&gt;</code> 中：</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;transaction&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="kw">&lt;td&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb18-6" title="6">  <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<p>這個模板表示單一條的表格列，其中包含了三格欄位：交易的<em>日期</em>、<em>物件</em> 與 <em>金額</em>。</p>
<p>接著，加入 <code>id</code> 屬性到模板的表格 <code>&lt;tbody&gt;</code> 元素中，讓 JavaScript 能更容易地取得：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">&lt;tbody</span><span class="ot"> id=</span><span class="st">&quot;transactions&quot;</span><span class="kw">&gt;&lt;/tbody&gt;</span></a></code></pre></div>
<p>當我們的 HTML 準備好時，我們切換到 JavaScript 檔案中，加入新函式 <code>createTransactionRow</code>：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">function</span> <span class="at">createTransactionRow</span>(transaction) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;transaction&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="kw">const</span> transactionRow <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="kw">const</span> tr <span class="op">=</span> <span class="va">transactionRow</span>.<span class="at">querySelector</span>(<span class="st">&#39;tr&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">0</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="at">date</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-6" title="6">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">1</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="at">object</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="va">tr</span>.<span class="at">children</span>[<span class="dv">2</span>].<span class="at">textContent</span> <span class="op">=</span> <span class="va">transaction</span>.<span class="va">amount</span>.<span class="at">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-8" title="8">  <span class="cf">return</span> transactionRow<span class="op">;</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>這個函式做就如它名字的功能：藉由剛建立的模板，建立出新的表格列並填入交易明細的資料。我們會在函式 <code>updateDashboard()</code> 中，利用它來更新表格：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">const</span> transactionsRows <span class="op">=</span> <span class="va">document</span>.<span class="at">createDocumentFragment</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="cf">for</span> (<span class="kw">const</span> transaction <span class="kw">of</span> <span class="va">account</span>.<span class="at">transactions</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="kw">const</span> transactionRow <span class="op">=</span> <span class="at">createTransactionRow</span>(transaction)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="va">transactionsRows</span>.<span class="at">appendChild</span>(transactionRow)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="at">updateElement</span>(<span class="st">&#39;transactions&#39;</span><span class="op">,</span> transactionsRows)<span class="op">;</span></a></code></pre></div>
<p>這裡我們使用了方法 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createDocumentFragment"><code>document.createDocumentFragment()</code></a>，建立新的 DOM 分段，再接到我們的 HTML 表格中。</p>
<p>我們還需要做一件事才能讓程式運作正常，目前函式 <code>updateElement()</code> 只能接受文字類型的內容。我們稍微修改一下程式碼：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">function</span> <span class="at">updateElement</span>(id<span class="op">,</span> textOrNode) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="kw">const</span> element <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(id)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="va">element</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span> <span class="co">// Removes all children</span></a>
<a class="sourceLine" id="cb22-4" title="4">  <span class="va">element</span>.<span class="at">append</span>(textOrNode)<span class="op">;</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>我們使用方法 <a href="https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/append"><code>append()</code></a>，它能連接文字或者是 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node">DOM 節點</a>到父元素中，正好滿足我們的需求。</p>
<p>試著以 <code>test</code> 帳戶來登入，你應該能看到儀表板顯示出交易明細了 🎉。</p>
<hr />
<h2 id="挑戰">🚀 挑戰</h2>
<p>花功夫讓儀表板頁面看起來像是正規的銀行界面。如果你已經為你的應用程式做好造型，你可以試試 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries">media queries</a> 來建立出<a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Responsive/responsive_design_building_blocks">回應式網頁設計</a>，它能完美地呈現在電腦或是行動裝置上。</p>
<p>這邊有造型過後的儀表板例子：</p>
<figure>
<img src="../../images/screen2.png" alt="造型化後的儀表板截圖" /><figcaption>造型化後的儀表板截圖</figcaption>
</figure>
<h2 id="課後測驗">課後測驗</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/46?loc=zh_tw">課後測驗</a></p>
<h2 id="作業">作業</h2>
<p><a href="assignment.zh-tw.md">重構並註解你的程式碼</a></p>
</body>
</html>
